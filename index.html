<!DOCTYPE html>
<html prefix="
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Tells the story of a guy's mishaps and shenanigans with computers.">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alessandro Bolletta</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://alexpacio.github.io/">
<link rel="icon" href="files/favicon.ico" sizes="16x16">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/embracing-the-ipv6-revolution-a-homelab-story/" type="text/html">
</head>
<body class="">
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

    <div class="hsidebar">
        <div class="container sidebar-sticky">
            <div class="sidebar-about">
              <h1>
                <a href="https://alexpacio.github.io/">
                      <h1 id="brand"><a href="https://alexpacio.github.io/" title="Alessandro Bolletta" rel="home">

        <span id="blog-title">Alessandro Bolletta</span>
    </a></h1>

                </a>
              </h1>
                <p class="lead">Tells the story of a guy's mishaps and shenanigans with computers.</p>

            </div>
                <nav id="menu" role="navigation" class="sidebar-nav"><a class="sidebar-nav-item" href=".">Home</a>
        <a class="sidebar-nav-item" href="archive.html">Archive</a>
        <a class="sidebar-nav-item" href="files/cv.pdf">CV</a>
        <a class="sidebar-nav-item" href="pages/about/">About me</a>
        <a class="sidebar-nav-item" href="https://github.com/alexpacio">My Github</a>
    
    
    </nav><footer id="footer"><span class="copyright">
              Contents © 2025         <a href="mailto:alexpacio91%20at%20gmail%20dot%20com">Alessandro Bolletta</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            </span>
            
            
        </footer>
</div>
    </div>

    <div class="content container" id="content">
    
<div class="post">
    <article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/embracing-the-ipv6-revolution-a-homelab-story/" class="u-url">Embracing the IPv6 Revolution: A Homelab Story</a></h1>
        <div class="metadata">
            <span class="post-date dateline"><time class="published dt-published" datetime="2025-05-30T10:00:00Z" title="2025-05-30 10:00">2025-05-30 10:00</time></span>
        </div>
    </header><div class="e-content entry-content">
    <p>The other day, I was contacted by a friend of mine asking for help setting up a home NAS (aka Network Attached Storage) based on OpenMediaVault. While he's an enthusiast, he wasn't able to properly configure all the technical aspects of the setup.</p>
<p>The NAS world is increasingly resembling a homelab rather than just file storage. Using Docker, you can get enterprise-grade software and setups running with quite simple steps.</p>
<p>After setting up the Docker containers, we faced the usual issue that most homelabs encounter these days: his internet connection was behind a CGNAT for IPv4 networking. However, I was pleasantly surprised to find an IPv6 public subnet already configured!</p>
<p>Since his intent was to use the NAS via LAN or his mobile phone (and those of his family/relatives), we investigated and figured out that various Italian 4G/5G carriers were providing IPv6 connectivity. So, we decided to give it a try.</p>
<p>I am surprised that IPv6 is still such an unexplored world, even though it's already here and many of us haven't even noticed. Carriers are starting to support it seriously, and the IPv4 scarcity situation is getting worse as time goes by.</p>
<p>One of the most interesting things about using IPv6 is that it truly enables <em>peer-to-peer</em> communication, as you no longer need inbound or outbound IP address translations (NAT) to communicate with others.</p>
<p>IPv6 is poised to be one of the biggest <em>silent</em> revolutions in the Internet/networking field. While it might not offer apparently groundbreaking innovations to the general public, it will enable us to be more interconnected.</p>
<p>The Internet is meant to be a democratic platform. However, if users are masked or filtered by CGNAT, they can never truly use the Internet actively. They become passive actors on the scene, mere consumers, or producers reliant on someone else's services or infrastructure. IPv6 enables a more democratic approach, where we can connect all of our devices, even personal ones, directly to the web and interact with others' devices without middlemen.</p>
<p>If you have a homelab, give IPv6 a try! Be prepared for the revolution and the major move to IPv6, which might happen sooner rather than later—even if you'd given up waiting for it!</p>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/hidden-costs-static-linking-containerization/" class="u-url">The Hidden Costs of Static Linking and Containerization: A Critical Analysis</a></h1>
        <div class="metadata">
            <span class="post-date dateline"><time class="published dt-published" datetime="2025-02-02T07:00:00Z" title="2025-02-02 07:00">2025-02-02 07:00</time></span>
        </div>
    </header><div class="e-content entry-content">
    <section id="statically-linked-programs-are-the-evil"><h2>Statically-linked Programs are the evil</h2>
<p>The trend toward static linking represents a fundamental regression in software engineering principles. By bundling every dependency directly into the executable, we're not just bloating our binaries - we're actively dismantling decades of progress in software modularization. Each statically linked program becomes an island, disconnected from the ecosystem of shared improvements and security updates.</p>
<p>Consider what happens when a critical vulnerability is discovered in a commonly used library. In a properly designed system using shared libraries, a single system update would protect all applications simultaneously. Instead, with static linking, we must embark on a complex and error-prone process of identifying every affected program, rebuilding each one individually, and ensuring they all get redeployed. This process isn't just inefficient - it's dangerously irresponsible and prone to oversights that could leave vulnerable versions running indefinitely.</p>
</section><section id="containerized-programs-are-the-evil-with-an-uppercased-e-at-the-beginning"><h2>Containerized Programs are the Evil (with an uppercased E at the beginning)</h2>
<p>If static linking is problematic, containerization compounds these issues exponentially. Not only do we face the fundamental problems of static linking, but we now multiply them across isolated environments. Each container becomes its own separate universe with redundant copies of shared resources, creating a nightmare of inefficiency and complexity.</p>
<p>The storage implications alone are staggering. Where a traditional system might maintain one copy of a commonly used library, a containerized environment duplicates this library across potentially hundreds of containers. This multiplication effect extends to memory usage as well - shared libraries can no longer be shared across container boundaries, leading to massive memory bloat as each container loads its own copy of identical code.</p>
<p>Deployment times suffer significantly as entire container images must be transferred across networks. What should be a simple application update becomes an exercise in moving entire system images. The orchestration requirements grow exponentially, requiring complex management systems just to keep track of all these isolated environments.</p>
</section><section id="both-produce-unsafe-applications-and-expose-you-at-risks"><h2>Both produce unsafe applications and expose you at risks</h2>
<p>Static linking and containerization create dangerous security time bombs by embedding frozen versions of libraries into applications, making it impossible to quickly patch discovered vulnerabilities. When a critical security flaw is found in a shared library, systems using dynamic linking can deploy a single patch to protect all applications simultaneously, while statically linked applications require individual rebuilds and redeployments - a process so complex that vulnerable versions often remain in production indefinitely. Containerization worsens this problem by bundling entire operating system environments, expanding the vulnerability surface exponentially and making security audits nightmarishly complex. Each container potentially includes thousands of packages that need individual tracking and updating, creating an unmanageable maze of dependencies. The false sense of security provided by containerization leads to dangerous complacency, as developers mistakenly believe container isolation protects them from security vulnerabilities while sharing the same kernel. Sensitive information like API keys often gets baked into static binaries or container images, making secret rotation difficult and increasing exposure risks. The solution lies in transparent, centrally managed dependencies that enable rapid security responses, not in the isolation and rigidity that static linking and containerization impose.</p>
</section><section id="why-we-do-love-to-statically-link-and-why-there-are-hidden-costs-behind-it"><h2>Why We Do Love to Statically Link and Why There Are Hidden Costs Behind It</h2>
<p>The seductive appeal of static linking lies in its promise of deployment simplicity and dependency predictability. Developers often embrace it because it seems to solve the "it works on my machine" problem - when everything is bundled together, environmental differences supposedly disappear. However, this apparent simplicity masks a deep complexity that manifests in numerous hidden costs.</p>
<p>The maintenance burden becomes particularly apparent over time. Security updates, which should be straightforward, turn into massive undertakings. Each statically linked program must be individually identified, rebuilt, and redeployed. Version tracking becomes exponentially more complex as each program effectively contains its own complete dependency tree. The testing burden multiplies because each static build represents a unique combination of library versions that must be verified independently.</p>
<p>Resource inefficiency manifests in multiple ways. Beyond the obvious waste of disk space from duplicate code, there's a significant memory overhead when multiple programs load their own copies of identical libraries. Build times increase dramatically as each program must compile all its dependencies from scratch, and deployment sizes balloon with redundant code.</p>
</section><section id="why-the-c-language-is-really-good-in-making-software-reusable"><h2>Why the C Language is Really Good in Making Software Reusable</h2>
<p>The C language's approach to software reuse through shared libraries represents one of its most sophisticated yet underappreciated features. At its core, C's ability to create stable Application Binary Interfaces (ABIs) enables a level of code reuse that modern approaches often fail to match. This isn't just about saving disk space - it's about creating a genuine ecosystem of reusable components.</p>
<p>The straightforward linking model in C allows programs to dynamically load code at runtime, enabling true resource sharing between applications. When multiple programs use the same library, they share the actual memory pages containing that code, significantly reducing the system's memory footprint. This sharing extends beyond mere storage efficiency - it enables system-wide optimizations that benefit all applications simultaneously.</p>
<p>Furthermore, C's model enables clear separation between applications and their dependencies while maintaining high performance. Platform-specific optimizations can be implemented at the library level, automatically benefiting all applications that use that library. This model has successfully powered Unix-like systems for decades, demonstrating its effectiveness in real-world deployments.</p>
<p>It's ridiculous to find how a language from 1970 offers better code reusability than the ones from 2020s. 55 years ago some wise people envisioned very smart concepts that are still foundational.</p>
</section><section id="why-an-operating-system-that-doesn-t-reuse-libraries-is-not-an-os-by-definition"><h2>Why an Operating System That Doesn't Reuse Libraries is Not an OS by Definition</h2>
<p>The fundamental purpose of an operating system extends far beyond merely managing hardware resources - it serves as a platform for sharing and coordinating resources among applications. When we bypass this through static linking and containerization, we're essentially creating multiple parallel "operating systems" within one host, fundamentally undermining the very concept of what an operating system should be.</p>
<p>Consider the primary responsibilities of an operating system: it must efficiently allocate system resources, manage shared memory, and coordinate access to hardware. These functions aren't meant to be isolated - they're designed to create a cooperative environment where applications can share resources efficiently. When each application brings its own copy of system libraries, we're not just duplicating code - we're fragmenting the very foundation of system resource management.</p>
<p>The provision of shared services represents another crucial aspect of operating system functionality. By maintaining common libraries available to all applications, the operating system creates a standardized platform for development and execution. This standardization isn't just about convenience - it's about creating a reliable, secure, and efficient computing environment. When applications bypass these shared services through static linking, they're effectively declaring independence from the operating system's core functionality.</p>
</section><section id="using-shared-libraries-would-make-programs-more-modern-testable-efficient"><h2>Using Shared Libraries Would Make Programs More Modern, Testable, Efficient</h2>
<p>The adoption of shared libraries aligns perfectly with modern software development practices, offering advantages that go far beyond simple resource sharing. Consider the impact on modularity: when programs rely on shared libraries, they naturally develop cleaner interfaces and better separation of concerns. This modularity isn't just theoretical - it manifests in practical benefits throughout the development lifecycle.</p>
<p>Testing becomes substantially more manageable with shared libraries. Instead of testing entire static binaries as monolithic units, developers can focus on testing the interactions between their code and well-defined library interfaces. This approach not only reduces testing complexity but also helps identify issues more precisely. When a bug is found in a shared library, fixing it benefits all applications simultaneously.</p>
<p>The efficiency gains from shared libraries extend throughout the entire software lifecycle. Build times decrease significantly when programs don't need to compile their dependencies from scratch. Deployments become faster and more reliable when they can rely on existing system libraries. Memory usage improves as multiple programs share the same library code in memory, and cache utilization becomes more efficient when common code paths are shared across applications.</p>
</section><section id="the-only-modern-revolution-i-see-coming-is-stateless-oses"><h2>The Only Modern Revolution I See Coming is Stateless OSes</h2>
<p>The future of operating systems lies not in static linking or containerization, but in embracing a truly stateless architecture that revolutionizes how we think about system resources and application dependencies. This vision combines the best aspects of immutable infrastructure with the efficiency of shared resources, creating a new paradigm for system design.</p>
<p>At the core of this revolution is the concept of an immutable system layer containing verified, signed dependencies. These system libraries would be read-only and atomic in their updates, eliminating many traditional points of failure in system maintenance. However, unlike current trends toward static linking, these libraries would be shared efficiently across all applications.</p>
<p>The user space in such a system would be truly dynamic, with intelligent library loading and version management. Instead of each application maintaining its own copies of libraries, the system would efficiently manage shared resources, loading different versions only when absolutely necessary and optimizing memory usage across all applications. This approach would maintain the isolation benefits that developers seek from static linking while eliminating the resource waste and security risks.</p>
<p>Security in this new paradigm would be fundamentally different from current approaches. Instead of relying on the isolation of static linking or containers, security would be built on a foundation of verified execution paths and centralized vulnerability management. System-wide security patches could be applied instantly and atomically, eliminating the complex coordination currently required to update statically linked applications.</p>
<p>The revolution isn't about finding new ways to isolate our code - it's about creating intelligent systems that can dynamically manage dependencies while maintaining security and efficiency. By moving away from the current trends of static linking and containerization, we can build systems that are truly efficient, secure, and maintainable. The future lies not in isolation, but in intelligent sharing of resources and code.</p>
</section><section id="containerized-or-statically-linked-applications-should-be-embraced-only-for-playground-or-very-small-deployments"><h2>Containerized or statically-linked applications should be embraced only for playground or very small deployments</h2>
<p>While I find useful using containers or statically-linked applications to build toy projects, and I am going to use them for these purposes, they cannot certainly be a reference model for the future.</p>
<p>snap, flatpak, AppImage, Docker should not be taken so seriously as they pretend to be.</p>
</section>
</div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/message-exchanges-using-zeromq/" class="u-url">Exchanging messages between processes (or even threads within the same program) using ZeroMQ</a></h1>
        <div class="metadata">
            <span class="post-date dateline"><time class="published dt-published" datetime="2025-01-27T18:00:00Z" title="2025-01-27 18:00">2025-01-27 18:00</time></span>
        </div>
    </header><div class="e-content entry-content">
    <section id="inter-process-communication-with-zeromq-and-protocol-buffers"><h2>Inter-Process Communication with ZeroMQ (and Protocol Buffers)</h2>
<section id="introduction"><h3>Introduction</h3>
<p>Some may certainly say that, when you are writing so called "daemons" under Linux/Unix OSes or "services" under Windows, you might want to use OS primitives/reuse existing libraries to make your programs communicate each other. And I strongly agree with the point: it is always a good idea to use a well-tested and solid library to implement such fundamental features such as message queues.</p>
<p>For example, under Linux you can use D-Bus, which allows IPC at scale within the OS scope. Or, in the microservices space, you can leverage on message brokers like RabbitMQ or Kafka to stream your messages through sophisticated routing logic. However, at times you are just looking for something trivial and simple to send and queue messages where at the same time you look for brokerless setup but still you are willing to leverage on some of the features that message queuing systems offer for free with ease. That's where ZeroMQ comes in.</p>
</section><section id="what-is-zeromq"><h3>What is ZeroMQ?</h3>
<p>ZeroMQ (ØMQ) is a high-performance asynchronous messaging library aimed at use in distributed or concurrent applications. It provides a message queue, but unlike message-oriented middleware, a ZeroMQ system can run without a dedicated message broker. The API layer provides a message-oriented abstraction of asynchronous network communication, multiple messaging patterns, message filtering, and more.</p>
</section><section id="supported-transport-protocols"><h3>Supported Transport Protocols</h3>
<p>ZeroMQ supports various transport protocols through different URI schemes where the main ones are:</p>
<ul class="simple">
<li><p><code class="docutils literal"><span class="pre">tcp://</span></code> - TCP transport</p></li>
<li><p><code class="docutils literal"><span class="pre">ipc://</span></code> - Inter-process communication (Unix domain sockets)</p></li>
<li><p><code class="docutils literal"><span class="pre">inproc://</span></code> - In-process communication between threads</p></li>
</ul></section><section id="thread-safety-and-context-management"><h3>Thread Safety and Context Management</h3>
<p>In both C and Go, ZeroMQ contexts are thread-safe, but sockets are not. Here's how to handle them properly:</p>
<p>In Go:</p>
<div class="code"><pre class="code go"><a id="rest_code_79c0d49333274421a51d81773a055086-1" name="rest_code_79c0d49333274421a51d81773a055086-1" href="posts/message-exchanges-using-zeromq/#rest_code_79c0d49333274421a51d81773a055086-1"></a><span class="c1">// Thread-safe context creation</span>
<a id="rest_code_79c0d49333274421a51d81773a055086-2" name="rest_code_79c0d49333274421a51d81773a055086-2" href="posts/message-exchanges-using-zeromq/#rest_code_79c0d49333274421a51d81773a055086-2"></a><span class="nx">context</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewContext</span><span class="p">()</span>
<a id="rest_code_79c0d49333274421a51d81773a055086-3" name="rest_code_79c0d49333274421a51d81773a055086-3" href="posts/message-exchanges-using-zeromq/#rest_code_79c0d49333274421a51d81773a055086-3"></a>
<a id="rest_code_79c0d49333274421a51d81773a055086-4" name="rest_code_79c0d49333274421a51d81773a055086-4" href="posts/message-exchanges-using-zeromq/#rest_code_79c0d49333274421a51d81773a055086-4"></a><span class="c1">// Socket creation should be done in the thread that uses it</span>
<a id="rest_code_79c0d49333274421a51d81773a055086-5" name="rest_code_79c0d49333274421a51d81773a055086-5" href="posts/message-exchanges-using-zeromq/#rest_code_79c0d49333274421a51d81773a055086-5"></a><span class="nx">socket</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">PUSH</span><span class="p">)</span>
<a id="rest_code_79c0d49333274421a51d81773a055086-6" name="rest_code_79c0d49333274421a51d81773a055086-6" href="posts/message-exchanges-using-zeromq/#rest_code_79c0d49333274421a51d81773a055086-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">socket</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
</pre></div>
<p>In C:</p>
<div class="code"><pre class="code c"><a id="rest_code_2be126cc502c45d39e29c2e5dcca912e-1" name="rest_code_2be126cc502c45d39e29c2e5dcca912e-1" href="posts/message-exchanges-using-zeromq/#rest_code_2be126cc502c45d39e29c2e5dcca912e-1"></a><span class="c1">// Thread-safe context creation</span>
<a id="rest_code_2be126cc502c45d39e29c2e5dcca912e-2" name="rest_code_2be126cc502c45d39e29c2e5dcca912e-2" href="posts/message-exchanges-using-zeromq/#rest_code_2be126cc502c45d39e29c2e5dcca912e-2"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_ctx_new</span><span class="p">();</span>
<a id="rest_code_2be126cc502c45d39e29c2e5dcca912e-3" name="rest_code_2be126cc502c45d39e29c2e5dcca912e-3" href="posts/message-exchanges-using-zeromq/#rest_code_2be126cc502c45d39e29c2e5dcca912e-3"></a>
<a id="rest_code_2be126cc502c45d39e29c2e5dcca912e-4" name="rest_code_2be126cc502c45d39e29c2e5dcca912e-4" href="posts/message-exchanges-using-zeromq/#rest_code_2be126cc502c45d39e29c2e5dcca912e-4"></a><span class="c1">// Socket creation - not thread-safe</span>
<a id="rest_code_2be126cc502c45d39e29c2e5dcca912e-5" name="rest_code_2be126cc502c45d39e29c2e5dcca912e-5" href="posts/message-exchanges-using-zeromq/#rest_code_2be126cc502c45d39e29c2e5dcca912e-5"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_PUSH</span><span class="p">);</span>
</pre></div>
</section><section id="intra-thread-communication-example"><h3>Intra-Thread Communication Example</h3>
<p>Here's an example of thread communication using ZeroMQ in C:</p>
<div class="code"><pre class="code c"><a id="rest_code_60164a3798e04d3aafab003f55027db6-1" name="rest_code_60164a3798e04d3aafab003f55027db6-1" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;zmq.h&gt;</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-2" name="rest_code_60164a3798e04d3aafab003f55027db6-2" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-3" name="rest_code_60164a3798e04d3aafab003f55027db6-3" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-4" name="rest_code_60164a3798e04d3aafab003f55027db6-4" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-4"></a>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-5" name="rest_code_60164a3798e04d3aafab003f55027db6-5" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-5"></a><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">worker_routine</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-6" name="rest_code_60164a3798e04d3aafab003f55027db6-6" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-6"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">receiver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_PULL</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-7" name="rest_code_60164a3798e04d3aafab003f55027db6-7" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-7"></a><span class="w">    </span><span class="n">zmq_connect</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span><span class="w"> </span><span class="s">"inproc://workers"</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-8" name="rest_code_60164a3798e04d3aafab003f55027db6-8" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-8"></a>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-9" name="rest_code_60164a3798e04d3aafab003f55027db6-9" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-9"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-10" name="rest_code_60164a3798e04d3aafab003f55027db6-10" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-10"></a><span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-11" name="rest_code_60164a3798e04d3aafab003f55027db6-11" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-11"></a><span class="w">        </span><span class="n">zmq_recv</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-12" name="rest_code_60164a3798e04d3aafab003f55027db6-12" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-12"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"Received: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-13" name="rest_code_60164a3798e04d3aafab003f55027db6-13" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-13"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-14" name="rest_code_60164a3798e04d3aafab003f55027db6-14" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-14"></a>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-15" name="rest_code_60164a3798e04d3aafab003f55027db6-15" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-15"></a><span class="w">    </span><span class="n">zmq_close</span><span class="p">(</span><span class="n">receiver</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-16" name="rest_code_60164a3798e04d3aafab003f55027db6-16" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-17" name="rest_code_60164a3798e04d3aafab003f55027db6-17" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-17"></a><span class="p">}</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-18" name="rest_code_60164a3798e04d3aafab003f55027db6-18" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-18"></a>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-19" name="rest_code_60164a3798e04d3aafab003f55027db6-19" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-19"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-20" name="rest_code_60164a3798e04d3aafab003f55027db6-20" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-20"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_ctx_new</span><span class="p">();</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-21" name="rest_code_60164a3798e04d3aafab003f55027db6-21" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-21"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_PUSH</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-22" name="rest_code_60164a3798e04d3aafab003f55027db6-22" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-22"></a>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-23" name="rest_code_60164a3798e04d3aafab003f55027db6-23" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-23"></a><span class="w">    </span><span class="n">zmq_bind</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="s">"inproc://workers"</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-24" name="rest_code_60164a3798e04d3aafab003f55027db6-24" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-24"></a>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-25" name="rest_code_60164a3798e04d3aafab003f55027db6-25" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-25"></a><span class="w">    </span><span class="n">pthread_t</span><span class="w"> </span><span class="n">worker</span><span class="p">;</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-26" name="rest_code_60164a3798e04d3aafab003f55027db6-26" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-26"></a><span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">worker</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">worker_routine</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-27" name="rest_code_60164a3798e04d3aafab003f55027db6-27" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-27"></a>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-28" name="rest_code_60164a3798e04d3aafab003f55027db6-28" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-28"></a><span class="w">    </span><span class="c1">// Send messages</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-29" name="rest_code_60164a3798e04d3aafab003f55027db6-29" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-29"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello Worker!"</span><span class="p">;</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-30" name="rest_code_60164a3798e04d3aafab003f55027db6-30" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-30"></a><span class="w">    </span><span class="n">zmq_send</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">message</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-31" name="rest_code_60164a3798e04d3aafab003f55027db6-31" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-31"></a>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-32" name="rest_code_60164a3798e04d3aafab003f55027db6-32" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-32"></a><span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// Allow time for message processing</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-33" name="rest_code_60164a3798e04d3aafab003f55027db6-33" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-33"></a>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-34" name="rest_code_60164a3798e04d3aafab003f55027db6-34" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-34"></a><span class="w">    </span><span class="n">zmq_close</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-35" name="rest_code_60164a3798e04d3aafab003f55027db6-35" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-35"></a><span class="w">    </span><span class="n">zmq_ctx_destroy</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-36" name="rest_code_60164a3798e04d3aafab003f55027db6-36" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-36"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="rest_code_60164a3798e04d3aafab003f55027db6-37" name="rest_code_60164a3798e04d3aafab003f55027db6-37" href="posts/message-exchanges-using-zeromq/#rest_code_60164a3798e04d3aafab003f55027db6-37"></a><span class="p">}</span>
</pre></div>
</section><section id="high-water-mark-and-flow-control"><h3>High Water Mark and Flow Control</h3>
<p>ZeroMQ provides flow control through the High Water Mark (HWM) feature. When the HWM is reached, ZeroMQ will either block or drop messages depending on the socket type and configuration:</p>
<div class="code"><pre class="code c"><a id="rest_code_90b56453512644b38fcfd89ebeec16e2-1" name="rest_code_90b56453512644b38fcfd89ebeec16e2-1" href="posts/message-exchanges-using-zeromq/#rest_code_90b56453512644b38fcfd89ebeec16e2-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">hwm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<a id="rest_code_90b56453512644b38fcfd89ebeec16e2-2" name="rest_code_90b56453512644b38fcfd89ebeec16e2-2" href="posts/message-exchanges-using-zeromq/#rest_code_90b56453512644b38fcfd89ebeec16e2-2"></a><span class="n">zmq_setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_SNDHWM</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hwm</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">hwm</span><span class="p">));</span>
<a id="rest_code_90b56453512644b38fcfd89ebeec16e2-3" name="rest_code_90b56453512644b38fcfd89ebeec16e2-3" href="posts/message-exchanges-using-zeromq/#rest_code_90b56453512644b38fcfd89ebeec16e2-3"></a>
<a id="rest_code_90b56453512644b38fcfd89ebeec16e2-4" name="rest_code_90b56453512644b38fcfd89ebeec16e2-4" href="posts/message-exchanges-using-zeromq/#rest_code_90b56453512644b38fcfd89ebeec16e2-4"></a><span class="c1">// To prevent dropping messages when HWM is reached</span>
<a id="rest_code_90b56453512644b38fcfd89ebeec16e2-5" name="rest_code_90b56453512644b38fcfd89ebeec16e2-5" href="posts/message-exchanges-using-zeromq/#rest_code_90b56453512644b38fcfd89ebeec16e2-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">nodrop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="rest_code_90b56453512644b38fcfd89ebeec16e2-6" name="rest_code_90b56453512644b38fcfd89ebeec16e2-6" href="posts/message-exchanges-using-zeromq/#rest_code_90b56453512644b38fcfd89ebeec16e2-6"></a><span class="n">zmq_setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_XPUB_NODROP</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nodrop</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">nodrop</span><span class="p">));</span>
</pre></div>
</section><section id="protocol-buffers-integration"><h3>Protocol Buffers Integration</h3>
<p>Since ZeroMQ only transfers raw bytes, it pairs well with Protocol Buffers for structured data serialization. Here's an example using both C++ and Go:</p>
<p>First, define your protocol buffer:</p>
<div class="code"><pre class="code protobuf"><a id="rest_code_30ac64ed6d184b20adab3c538c242c2e-1" name="rest_code_30ac64ed6d184b20adab3c538c242c2e-1" href="posts/message-exchanges-using-zeromq/#rest_code_30ac64ed6d184b20adab3c538c242c2e-1"></a><span class="c1">// message.proto</span>
<a id="rest_code_30ac64ed6d184b20adab3c538c242c2e-2" name="rest_code_30ac64ed6d184b20adab3c538c242c2e-2" href="posts/message-exchanges-using-zeromq/#rest_code_30ac64ed6d184b20adab3c538c242c2e-2"></a><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"proto3"</span><span class="p">;</span>
<a id="rest_code_30ac64ed6d184b20adab3c538c242c2e-3" name="rest_code_30ac64ed6d184b20adab3c538c242c2e-3" href="posts/message-exchanges-using-zeromq/#rest_code_30ac64ed6d184b20adab3c538c242c2e-3"></a>
<a id="rest_code_30ac64ed6d184b20adab3c538c242c2e-4" name="rest_code_30ac64ed6d184b20adab3c538c242c2e-4" href="posts/message-exchanges-using-zeromq/#rest_code_30ac64ed6d184b20adab3c538c242c2e-4"></a><span class="kd">message</span><span class="w"> </span><span class="nc">DataMessage</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_30ac64ed6d184b20adab3c538c242c2e-5" name="rest_code_30ac64ed6d184b20adab3c538c242c2e-5" href="posts/message-exchanges-using-zeromq/#rest_code_30ac64ed6d184b20adab3c538c242c2e-5"></a><span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="rest_code_30ac64ed6d184b20adab3c538c242c2e-6" name="rest_code_30ac64ed6d184b20adab3c538c242c2e-6" href="posts/message-exchanges-using-zeromq/#rest_code_30ac64ed6d184b20adab3c538c242c2e-6"></a><span class="w">    </span><span class="kt">int64</span><span class="w"> </span><span class="na">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="rest_code_30ac64ed6d184b20adab3c538c242c2e-7" name="rest_code_30ac64ed6d184b20adab3c538c242c2e-7" href="posts/message-exchanges-using-zeromq/#rest_code_30ac64ed6d184b20adab3c538c242c2e-7"></a><span class="p">}</span>
</pre></div>
<p>Using it in Go:</p>
<div class="code"><pre class="code go"><a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-1" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-1" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-2" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-2" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-2"></a>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-3" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-3" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-4" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-4" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-4"></a><span class="w">    </span><span class="s">"log"</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-5" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-5" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-5"></a>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-6" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-6" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-6"></a><span class="w">    </span><span class="s">"github.com/pebbe/zmq4"</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-7" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-7" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-7"></a><span class="w">    </span><span class="s">"google.golang.org/protobuf/proto"</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-8" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-8" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-8"></a><span class="w">    </span><span class="nx">examplepb</span><span class="w"> </span><span class="s">"path/to/generated/proto"</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-9" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-9" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-9"></a><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-10" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-10" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-10"></a>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-11" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-11" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-12" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-12" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-12"></a><span class="w">    </span><span class="c1">// Create a ZeroMQ context</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-13" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-13" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-13"></a><span class="w">    </span><span class="nx">context</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewContext</span><span class="p">()</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-14" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-14" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-15" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-15" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-15"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"Failed to create ZeroMQ context: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-16" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-16" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-16"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-17" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-17" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-17"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Term</span><span class="p">()</span><span class="w"> </span><span class="c1">// Ensure the context is terminated when the program exits</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-18" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-18" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-18"></a>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-19" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-19" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-19"></a><span class="w">    </span><span class="c1">// Create a ZeroMQ Subscriber socket</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-20" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-20" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-20"></a><span class="w">    </span><span class="nx">subscriber</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">SUB</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-21" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-21" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-22" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-22" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-22"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"Failed to create subscriber socket: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-23" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-23" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-23"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-24" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-24" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-24"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-25" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-25" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-25"></a>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-26" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-26" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-26"></a><span class="w">    </span><span class="c1">// Connect to the publisher</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-27" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-27" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-27"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="s">"tcp://127.0.0.1:5555"</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-28" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-28" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-29" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-29" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-29"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"Failed to connect subscriber: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-30" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-30" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-30"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-31" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-31" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-31"></a>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-32" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-32" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-32"></a><span class="w">    </span><span class="c1">// Subscribe to all messages</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-33" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-33" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-33"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">SetSubscribe</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-34" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-34" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-35" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-35" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-35"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"Failed to set subscription: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-36" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-36" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-36"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-37" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-37" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-37"></a>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-38" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-38" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-38"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Subscriber started, waiting for messages..."</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-39" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-39" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-39"></a>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-40" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-40" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-40"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-41" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-41" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-41"></a><span class="w">        </span><span class="c1">// Receive the serialized message</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-42" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-42" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-42"></a><span class="w">        </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">RecvBytes</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-43" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-43" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-43"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-44" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-44" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-44"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Failed to receive message: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-45" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-45" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-45"></a><span class="w">            </span><span class="k">continue</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-46" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-46" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-46"></a><span class="w">        </span><span class="p">}</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-47" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-47" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-47"></a>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-48" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-48" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-48"></a><span class="w">        </span><span class="c1">// Deserialize the message</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-49" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-49" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-49"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="nx">examplepb</span><span class="p">.</span><span class="nx">ExampleMessage</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-50" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-50" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-50"></a><span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">message</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-51" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-51" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-51"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-52" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-52" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-52"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Failed to deserialize message: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-53" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-53" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-53"></a><span class="w">            </span><span class="k">continue</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-54" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-54" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-54"></a><span class="w">        </span><span class="p">}</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-55" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-55" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-55"></a>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-56" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-56" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-56"></a><span class="w">        </span><span class="c1">// Print the received message</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-57" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-57" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-57"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Received message: ID=%s, Content=%s"</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">Content</span><span class="p">)</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-58" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-58" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-58"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_adb0beae035c4e4aafbc38e0d8421239-59" name="rest_code_adb0beae035c4e4aafbc38e0d8421239-59" href="posts/message-exchanges-using-zeromq/#rest_code_adb0beae035c4e4aafbc38e0d8421239-59"></a><span class="p">}</span>
</pre></div>
</section><section id="explanation"><h3>Explanation</h3>
<p>Context: The zmq.NewContext() function creates a new ZeroMQ context, which is required to create sockets.</p>
<p>Socket: The context.NewSocket(zmq.SUB) function creates a new SUB socket for subscribing to messages.</p>
<p>Connect: The subscriber.Connect("<a class="reference external" href="tcp://localhost:5555">tcp://localhost:5555</a>") function connects the subscriber to the publisher’s address.</p>
<p>Subscribe: The socket.SetSubscribe("") function subscribes to all messages (an empty string means subscribe to everything). This acts as a way to subscribe to a string prefix (so called "topic" in other MQ systems)</p>
<p>Recv: The socket.RecvBytes(0) function blocks until a message is received.</p>
</section><section id="asynchronous-message-emission"><h3>Asynchronous Message Emission</h3>
<p>ZeroMQ supports non-blocking sends using the <code class="docutils literal">ZMQ_DONTWAIT</code> flag:</p>
<div class="code"><pre class="code c"><a id="rest_code_2acc8f24b8fb457bb6a3c5badfdaea5a-1" name="rest_code_2acc8f24b8fb457bb6a3c5badfdaea5a-1" href="posts/message-exchanges-using-zeromq/#rest_code_2acc8f24b8fb457bb6a3c5badfdaea5a-1"></a><span class="n">zmq_send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_DONTWAIT</span><span class="p">);</span>
<a id="rest_code_2acc8f24b8fb457bb6a3c5badfdaea5a-2" name="rest_code_2acc8f24b8fb457bb6a3c5badfdaea5a-2" href="posts/message-exchanges-using-zeromq/#rest_code_2acc8f24b8fb457bb6a3c5badfdaea5a-2"></a><span class="c1">// Code continues immediately without waiting for the send operation outcome</span>
</pre></div>
</section><section id="performance-considerations"><h3>Performance Considerations</h3>
<p>ZeroMQ is particularly well-suited for high-performance scenarios where:</p>
<ol class="arabic simple">
<li><p>You need to decouple the message producer from the consumer</p></li>
<li><p>The critical section needs to emit messages without blocking</p></li>
<li><p>You want to avoid the overhead of a message broker</p></li>
<li><p>You need reliable message delivery without managing it yourself</p></li>
</ol>
<p>The library handles many complex aspects automatically:</p>
<ul class="simple">
<li><p>Message framing</p></li>
<li><p>Connection handling and reconnection</p></li>
<li><p>Message queuing</p></li>
<li><p>Fair message distribution</p></li>
<li><p>Transport abstraction</p></li>
</ul></section><section id="zeromq-messaging-patterns"><h3>ZeroMQ Messaging Patterns</h3>
<p>ZeroMQ supports several fundamental messaging patterns, each designed for specific use cases:</p>
<section id="push-pull-pipeline"><h4>Push/Pull (Pipeline)</h4>
<p>The Push/Pull pattern creates a one-way data distribution pipeline. Messages sent by pushers are load-balanced among all connected pullers.</p>
<div class="code"><pre class="code c"><a id="rest_code_8a428b997e344e74914a2a17f66cc071-1" name="rest_code_8a428b997e344e74914a2a17f66cc071-1" href="posts/message-exchanges-using-zeromq/#rest_code_8a428b997e344e74914a2a17f66cc071-1"></a><span class="c1">// Pusher (sender)</span>
<a id="rest_code_8a428b997e344e74914a2a17f66cc071-2" name="rest_code_8a428b997e344e74914a2a17f66cc071-2" href="posts/message-exchanges-using-zeromq/#rest_code_8a428b997e344e74914a2a17f66cc071-2"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">pusher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_PUSH</span><span class="p">);</span>
<a id="rest_code_8a428b997e344e74914a2a17f66cc071-3" name="rest_code_8a428b997e344e74914a2a17f66cc071-3" href="posts/message-exchanges-using-zeromq/#rest_code_8a428b997e344e74914a2a17f66cc071-3"></a><span class="n">zmq_bind</span><span class="p">(</span><span class="n">pusher</span><span class="p">,</span><span class="w"> </span><span class="s">"tcp://*:5557"</span><span class="p">);</span>
<a id="rest_code_8a428b997e344e74914a2a17f66cc071-4" name="rest_code_8a428b997e344e74914a2a17f66cc071-4" href="posts/message-exchanges-using-zeromq/#rest_code_8a428b997e344e74914a2a17f66cc071-4"></a>
<a id="rest_code_8a428b997e344e74914a2a17f66cc071-5" name="rest_code_8a428b997e344e74914a2a17f66cc071-5" href="posts/message-exchanges-using-zeromq/#rest_code_8a428b997e344e74914a2a17f66cc071-5"></a><span class="c1">// Puller (receiver)</span>
<a id="rest_code_8a428b997e344e74914a2a17f66cc071-6" name="rest_code_8a428b997e344e74914a2a17f66cc071-6" href="posts/message-exchanges-using-zeromq/#rest_code_8a428b997e344e74914a2a17f66cc071-6"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">puller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_PULL</span><span class="p">);</span>
<a id="rest_code_8a428b997e344e74914a2a17f66cc071-7" name="rest_code_8a428b997e344e74914a2a17f66cc071-7" href="posts/message-exchanges-using-zeromq/#rest_code_8a428b997e344e74914a2a17f66cc071-7"></a><span class="n">zmq_connect</span><span class="p">(</span><span class="n">puller</span><span class="p">,</span><span class="w"> </span><span class="s">"tcp://localhost:5557"</span><span class="p">);</span>
</pre></div>
<p>Use cases:</p>
<ul class="simple">
<li><p>Parallel task distribution</p></li>
<li><p>Workload distribution in producer/consumer scenarios</p></li>
<li><p>Data pipeline processing</p></li>
</ul></section><section id="pub-sub-publisher-subscriber"><h4>Pub/Sub (Publisher/Subscriber)</h4>
<p>Publishers send messages while subscribers receive them based on topics. Each subscriber can subscribe to multiple topics.</p>
<div class="code"><pre class="code go"><a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-1" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-1" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-1"></a><span class="c1">// Publisher</span>
<a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-2" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-2" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-2"></a><span class="nx">publisher</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">PUB</span><span class="p">)</span>
<a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-3" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-3" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-3"></a><span class="nx">publisher</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="s">"tcp://*:5563"</span><span class="p">)</span>
<a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-4" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-4" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-4"></a>
<a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-5" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-5" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-5"></a><span class="c1">// Send message with topic</span>
<a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-6" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-6" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-6"></a><span class="nx">publisher</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="s">"weather.london temperature:22"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-7" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-7" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-7"></a>
<a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-8" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-8" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-8"></a><span class="c1">// Subscriber</span>
<a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-9" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-9" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-9"></a><span class="nx">subscriber</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">SUB</span><span class="p">)</span>
<a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-10" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-10" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-10"></a><span class="nx">subscriber</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="s">"tcp://localhost:5563"</span><span class="p">)</span>
<a id="rest_code_3ae6a7df838a42cca42a1c4b513b3160-11" name="rest_code_3ae6a7df838a42cca42a1c4b513b3160-11" href="posts/message-exchanges-using-zeromq/#rest_code_3ae6a7df838a42cca42a1c4b513b3160-11"></a><span class="nx">subscriber</span><span class="p">.</span><span class="nx">SetSubscribe</span><span class="p">(</span><span class="s">"weather.london"</span><span class="p">)</span>
</pre></div>
<p>Use cases:</p>
<ul class="simple">
<li><p>Event broadcasting</p></li>
<li><p>Real-time data feeds</p></li>
<li><p>System monitoring</p></li>
<li><p>Live updates</p></li>
</ul></section><section id="request-reply-req-rep"><h4>Request/Reply (REQ/REP)</h4>
<p>A synchronous pattern where each request must be followed by a reply.</p>
<div class="code"><pre class="code c"><a id="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-1" name="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-1" href="posts/message-exchanges-using-zeromq/#rest_code_345ef7d70e6048a4b52cbffd5eb399fd-1"></a><span class="c1">// Server (Reply)</span>
<a id="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-2" name="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-2" href="posts/message-exchanges-using-zeromq/#rest_code_345ef7d70e6048a4b52cbffd5eb399fd-2"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">responder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_REP</span><span class="p">);</span>
<a id="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-3" name="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-3" href="posts/message-exchanges-using-zeromq/#rest_code_345ef7d70e6048a4b52cbffd5eb399fd-3"></a><span class="n">zmq_bind</span><span class="p">(</span><span class="n">responder</span><span class="p">,</span><span class="w"> </span><span class="s">"tcp://*:5555"</span><span class="p">);</span>
<a id="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-4" name="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-4" href="posts/message-exchanges-using-zeromq/#rest_code_345ef7d70e6048a4b52cbffd5eb399fd-4"></a>
<a id="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-5" name="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-5" href="posts/message-exchanges-using-zeromq/#rest_code_345ef7d70e6048a4b52cbffd5eb399fd-5"></a><span class="c1">// Client (Request)</span>
<a id="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-6" name="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-6" href="posts/message-exchanges-using-zeromq/#rest_code_345ef7d70e6048a4b52cbffd5eb399fd-6"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">requester</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_REQ</span><span class="p">);</span>
<a id="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-7" name="rest_code_345ef7d70e6048a4b52cbffd5eb399fd-7" href="posts/message-exchanges-using-zeromq/#rest_code_345ef7d70e6048a4b52cbffd5eb399fd-7"></a><span class="n">zmq_connect</span><span class="p">(</span><span class="n">requester</span><span class="p">,</span><span class="w"> </span><span class="s">"tcp://localhost:5555"</span><span class="p">);</span>
</pre></div>
<p>Use cases:</p>
<ul class="simple">
<li><p>Remote procedure calls (RPC)</p></li>
<li><p>Service APIs</p></li>
<li><p>Task delegation with acknowledgment</p></li>
</ul></section><section id="dealer-router"><h4>Dealer/Router</h4>
<p>An advanced asynchronous pattern that allows for complex routing scenarios.</p>
<div class="code"><pre class="code go"><a id="rest_code_88d11188eef44b93be2663f6c4b4dffc-1" name="rest_code_88d11188eef44b93be2663f6c4b4dffc-1" href="posts/message-exchanges-using-zeromq/#rest_code_88d11188eef44b93be2663f6c4b4dffc-1"></a><span class="c1">// Router</span>
<a id="rest_code_88d11188eef44b93be2663f6c4b4dffc-2" name="rest_code_88d11188eef44b93be2663f6c4b4dffc-2" href="posts/message-exchanges-using-zeromq/#rest_code_88d11188eef44b93be2663f6c4b4dffc-2"></a><span class="nx">router</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">ROUTER</span><span class="p">)</span>
<a id="rest_code_88d11188eef44b93be2663f6c4b4dffc-3" name="rest_code_88d11188eef44b93be2663f6c4b4dffc-3" href="posts/message-exchanges-using-zeromq/#rest_code_88d11188eef44b93be2663f6c4b4dffc-3"></a><span class="nx">router</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="s">"tcp://*:5555"</span><span class="p">)</span>
<a id="rest_code_88d11188eef44b93be2663f6c4b4dffc-4" name="rest_code_88d11188eef44b93be2663f6c4b4dffc-4" href="posts/message-exchanges-using-zeromq/#rest_code_88d11188eef44b93be2663f6c4b4dffc-4"></a>
<a id="rest_code_88d11188eef44b93be2663f6c4b4dffc-5" name="rest_code_88d11188eef44b93be2663f6c4b4dffc-5" href="posts/message-exchanges-using-zeromq/#rest_code_88d11188eef44b93be2663f6c4b4dffc-5"></a><span class="c1">// Dealer</span>
<a id="rest_code_88d11188eef44b93be2663f6c4b4dffc-6" name="rest_code_88d11188eef44b93be2663f6c4b4dffc-6" href="posts/message-exchanges-using-zeromq/#rest_code_88d11188eef44b93be2663f6c4b4dffc-6"></a><span class="nx">dealer</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">DEALER</span><span class="p">)</span>
<a id="rest_code_88d11188eef44b93be2663f6c4b4dffc-7" name="rest_code_88d11188eef44b93be2663f6c4b4dffc-7" href="posts/message-exchanges-using-zeromq/#rest_code_88d11188eef44b93be2663f6c4b4dffc-7"></a><span class="nx">dealer</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="s">"tcp://localhost:5555"</span><span class="p">)</span>
</pre></div>
<p>Use cases:</p>
<ul class="simple">
<li><p>Load balancing</p></li>
<li><p>Asynchronous request/reply</p></li>
<li><p>Complex routing topologies</p></li>
<li><p>Service meshes</p></li>
</ul></section><section id="pattern-selection-guidelines"><h4>Pattern Selection Guidelines</h4>
<p>When choosing a pattern, consider:</p>
<p>Message Flow Direction:</p>
<ul class="simple">
<li><p>One-way: Push/Pull or Pub/Sub</p></li>
<li><p>Two-way: Request/Reply or Dealer/Router</p></li>
</ul>
<p>Synchronization Requirements:</p>
<ul class="simple">
<li><p>Synchronous: Request/Reply</p></li>
<li><p>Asynchronous: Push/Pull, Pub/Sub, Dealer/Router</p></li>
</ul>
<p>Scalability Needs:</p>
<ul class="simple">
<li><p>Fan-out: Pub/Sub</p></li>
<li><p>Load balancing: Push/Pull or Dealer/Router</p></li>
<li><p>Both: Combination of patterns</p></li>
</ul>
<p>Message Delivery Guarantees:</p>
<ul class="simple">
<li><p>At-most-once: Pub/Sub</p></li>
<li><p>At-least-once: Request/Reply</p></li>
<li><p>Custom guarantees: Dealer/Router</p></li>
</ul></section><section id="example-combining-patterns"><h4>Example: Combining Patterns</h4>
<p>Here's an example combining Pub/Sub with Push/Pull for a logging system:</p>
<div class="code"><pre class="code go"><a id="rest_code_786812ac164e451cba0ae887134335f4-1" name="rest_code_786812ac164e451cba0ae887134335f4-1" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-2" name="rest_code_786812ac164e451cba0ae887134335f4-2" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-2"></a>
<a id="rest_code_786812ac164e451cba0ae887134335f4-3" name="rest_code_786812ac164e451cba0ae887134335f4-3" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-4" name="rest_code_786812ac164e451cba0ae887134335f4-4" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-4"></a><span class="w">    </span><span class="s">"github.com/pebbe/zmq4"</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-5" name="rest_code_786812ac164e451cba0ae887134335f4-5" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-5"></a><span class="w">    </span><span class="s">"log"</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-6" name="rest_code_786812ac164e451cba0ae887134335f4-6" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-6"></a><span class="p">)</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-7" name="rest_code_786812ac164e451cba0ae887134335f4-7" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-7"></a>
<a id="rest_code_786812ac164e451cba0ae887134335f4-8" name="rest_code_786812ac164e451cba0ae887134335f4-8" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-9" name="rest_code_786812ac164e451cba0ae887134335f4-9" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-9"></a><span class="w">    </span><span class="c1">// Event publisher</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-10" name="rest_code_786812ac164e451cba0ae887134335f4-10" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-10"></a><span class="w">    </span><span class="nx">publisher</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">PUB</span><span class="p">)</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-11" name="rest_code_786812ac164e451cba0ae887134335f4-11" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-11"></a><span class="w">    </span><span class="nx">publisher</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="s">"tcp://*:5563"</span><span class="p">)</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-12" name="rest_code_786812ac164e451cba0ae887134335f4-12" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-12"></a>
<a id="rest_code_786812ac164e451cba0ae887134335f4-13" name="rest_code_786812ac164e451cba0ae887134335f4-13" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-13"></a><span class="w">    </span><span class="c1">// Log collector</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-14" name="rest_code_786812ac164e451cba0ae887134335f4-14" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-14"></a><span class="w">    </span><span class="nx">collector</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">PULL</span><span class="p">)</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-15" name="rest_code_786812ac164e451cba0ae887134335f4-15" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-15"></a><span class="w">    </span><span class="nx">collector</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="s">"tcp://*:5564"</span><span class="p">)</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-16" name="rest_code_786812ac164e451cba0ae887134335f4-16" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-16"></a>
<a id="rest_code_786812ac164e451cba0ae887134335f4-17" name="rest_code_786812ac164e451cba0ae887134335f4-17" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-17"></a><span class="w">    </span><span class="c1">// Worker that processes logs and publishes events</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-18" name="rest_code_786812ac164e451cba0ae887134335f4-18" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-18"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-19" name="rest_code_786812ac164e451cba0ae887134335f4-19" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-19"></a><span class="w">        </span><span class="nx">worker</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">PUSH</span><span class="p">)</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-20" name="rest_code_786812ac164e451cba0ae887134335f4-20" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-20"></a><span class="w">        </span><span class="nx">worker</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="s">"tcp://localhost:5564"</span><span class="p">)</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-21" name="rest_code_786812ac164e451cba0ae887134335f4-21" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-21"></a>
<a id="rest_code_786812ac164e451cba0ae887134335f4-22" name="rest_code_786812ac164e451cba0ae887134335f4-22" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-22"></a><span class="w">        </span><span class="nx">subscriber</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">SUB</span><span class="p">)</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-23" name="rest_code_786812ac164e451cba0ae887134335f4-23" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-23"></a><span class="w">        </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="s">"tcp://localhost:5563"</span><span class="p">)</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-24" name="rest_code_786812ac164e451cba0ae887134335f4-24" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-24"></a><span class="w">        </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">SetSubscribe</span><span class="p">(</span><span class="s">"error"</span><span class="p">)</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-25" name="rest_code_786812ac164e451cba0ae887134335f4-25" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-25"></a>
<a id="rest_code_786812ac164e451cba0ae887134335f4-26" name="rest_code_786812ac164e451cba0ae887134335f4-26" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-26"></a><span class="w">        </span><span class="c1">// Process messages...</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-27" name="rest_code_786812ac164e451cba0ae887134335f4-27" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-27"></a><span class="w">    </span><span class="p">}()</span>
<a id="rest_code_786812ac164e451cba0ae887134335f4-28" name="rest_code_786812ac164e451cba0ae887134335f4-28" href="posts/message-exchanges-using-zeromq/#rest_code_786812ac164e451cba0ae887134335f4-28"></a><span class="p">}</span>
</pre></div>
<p>This setup allows for:
- Real-time error broadcasting (Pub/Sub)
- Reliable log collection (Push/Pull)
- Scalable processing workers
- Decoupled components</p>
<p>The choice of pattern significantly impacts your system's behavior, performance, and scalability. It's often beneficial to combine patterns to achieve more complex messaging requirements while maintaining simplicity in individual components.</p>
</section></section><section id="conclusion"><h3>Conclusion</h3>
<p>When you need a lightweight, broker-less messaging solution with good performance characteristics, ZeroMQ provides an excellent balance of features and simplicity. It's particularly valuable in scenarios where you need to quickly implement reliable inter-process or inter-thread communication without the overhead of a full message broker infrastructure.</p>
<p>While it may not replace more robust solutions like Kafka for large-scale distributed systems, ZeroMQ fills an important niche for local and small-scale distributed messaging needs, especially when performance is a critical factor.</p>
</section><section id="useful-links"><h3>Useful Links</h3>
<ul class="simple">
<li><p>ZeroMQ Official Website: <a class="reference external" href="https://zeromq.org/">https://zeromq.org/</a></p></li>
<li><p>ZeroMQ Documentation: <a class="reference external" href="https://zeromq.org/get-started/">https://zeromq.org/get-started/</a></p></li>
<li><p>Protocol Buffers Official Website: <a class="reference external" href="https://protobuf.dev/">https://protobuf.dev/</a></p></li>
<li><p>Protocol Buffers Documentation: <a class="reference external" href="https://protobuf.dev/overview/">https://protobuf.dev/overview/</a></p></li>
<li><p>ZeroMQ Guide: <a class="reference external" href="https://zguide.zeromq.org/">https://zguide.zeromq.org/</a></p></li>
</ul></section></section>
</div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/lightweight-nodejs-background-job-scheduler/" class="u-url">Building a Lightweight Node.js Background Job Scheduler: A Practical Solution for Simple Web Applications</a></h1>
        <div class="metadata">
            <span class="post-date dateline"><time class="published dt-published" datetime="2024-10-10T12:00:00Z" title="2024-10-10 12:00">2024-10-10 12:00</time></span>
        </div>
    </header><div class="e-content entry-content">
    <section id="building-a-lightweight-node-js-background-job-scheduler"><h2>Building a Lightweight Node.js Background Job Scheduler</h2>
<p>As developers, we often come across situations where a fully-fledged background job system, with all its bells and whistles, might be overkill for our project needs. This was the case for me when I built a custom background job scheduler in <strong>TypeScript</strong> and <strong>Node.js</strong>, designed to handle essential tasks without the overhead of larger, more complex solutions.</p>
<section id="the-need-for-a-simple-solution"><h3>The Need for a Simple Solution</h3>
<p>My project involved a web application that required periodic background tasks, such as <strong>data synchronization</strong>, <strong>cleanup jobs</strong>, and <strong>basic system monitoring</strong>. While there are many mature background job frameworks available, most were too feature-heavy for what I needed. I wanted something small, efficient, and easy to integrate into my Docker-based setup, without introducing unnecessary complexity.</p>
<p>That’s when I decided to write my own scheduler—lean, concise, and perfect for simple backend apps or as a side container to complement larger web applications.</p>
</section><section id="the-custom-scheduler-small-but-effective"><h3>The Custom Scheduler: Small but Effective</h3>
<p>The goal was to create a <strong>minimalistic background job scheduler</strong> that could be easily run in a Docker container alongside the main web application. Written in <strong>TypeScript</strong> and <strong>Node.js</strong>, the solution is focused purely on executing periodic tasks with the least amount of code possible, while ensuring it’s flexible enough to be extended for future needs.</p>
<p>Unlike robust job schedulers like <strong>Bull</strong> or <strong>Agenda</strong>, my custom scheduler strips away non-essential features and focuses on what truly matters for small applications: <strong>reliability and ease of use</strong>. It supports scheduling jobs at specific intervals, retrying on failure, and executing scripts or commands as needed. By keeping the codebase concise, the scheduler can be easily maintained and quickly deployed.</p>
</section><section id="seamless-integration-into-docker"><h3>Seamless Integration into Docker</h3>
<p>The scheduler is designed to be packaged as a <strong>multi-layer Docker container</strong>. This approach allows me to include all the necessary <strong>CLI tools and backend executables</strong> in one place, ensuring that the container remains isolated but tightly integrated with the rest of the application.</p>
<p>This makes it an ideal <strong>sidecar container</strong> to handle tasks for a larger web application. Its small footprint ensures that it won’t introduce significant overhead, making it an excellent choice for environments where resources are limited, such as microservices architectures or smaller backend deployments.</p>
</section><section id="real-time-observability-telegram-bot-and-email-alerts"><h3>Real-Time Observability: Telegram Bot and Email Alerts</h3>
<p>One of the unique aspects of this project was adding easy <strong>observability</strong> and <strong>control</strong> via a <strong>Telegram bot</strong> and <strong>email notifications</strong>. While the scheduler itself is minimalistic, I wanted to ensure I had a convenient way to monitor job status and handle any failures without diving into logs or dashboards.</p>
<p>The Telegram bot integration allows me to start or stop jobs, check their status, and receive instant notifications when something goes wrong. This real-time control, paired with email alerts for periodic updates or error logs, ensures I stay informed even when the jobs are running in the background.</p>
</section><section id="perfect-for-small-scale-applications"><h3>Perfect for Small-Scale Applications</h3>
<p>This background job scheduler might not have the rich feature set of other established systems, but that’s exactly why it works so well in certain scenarios. For <strong>smaller applications</strong> or web services that don’t require a heavy-duty job queue, this solution offers a lightweight, easy-to-manage alternative. It handles the basics efficiently, making it perfect for production environments where <strong>simplicity</strong> and <strong>performance</strong> are crucial.</p>
</section><section id="final-thoughts"><h3>Final Thoughts</h3>
<p>Creating this custom background job scheduler has been a rewarding experience. It’s not meant to replace more feature-rich systems, but rather fill the gap for projects where adding complex tooling would be overkill. With a <strong>small and concise codebase</strong>, seamless <strong>Docker integration</strong>, and <strong>real-time observability</strong> via Telegram and email, this scheduler has become an invaluable part of my workflow.</p>
<p>If you're working on a small backend or need a side container to handle background jobs without the complexity of larger frameworks, this custom solution might be just what you're looking for.</p>
<p>If you're tackling a similar challenge in your project, I highly recommend to have a try with the Background Job scheduler: <a class="reference external" href="https://github.com/alexpacio/background-job-scheduler">https://github.com/alexpacio/background-job-scheduler</a></p>
</section></section>
</div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/python-k8s-api/" class="u-url">Full-fledged API + e2e tests + benchmark + IaC + Helm charts + more as an (interesting) exercise!</a></h1>
        <div class="metadata">
            <span class="post-date dateline"><time class="published dt-published" datetime="2024-09-22T14:19:03+02:00" title="2024-09-22 14:19">2024-09-22 14:19</time></span>
        </div>
    </header><div class="e-content entry-content">
    <p>Last week, I was contacted for a coding challenge. The project seemed interesting, so I decided to take it on. At the very least, I would learn something new, which I was eager to explore: Pulumi, k6, FastAPI and some fancy modern things that make you look like a cool dev!</p>
<p>The project involved creating a simple REST API in Python, which needed to be packaged with Helm, ready for deployment in a Kubernetes (K8s) cluster, and including all the essential tools required.</p>
<p><strong>Requirements</strong></p>
<ul class="simple">
<li><p>A Python REST API backend program. The choice of framework was up to me</p></li>
<li><p>Unit and e2e tests</p></li>
<li><p>Swagger/OpenAPI documentation</p></li>
<li><p>A CDK-like deployment script to automate the API’s dependencies: Terraform or Pulumi (for an AWS CDK-like experience). Since I was curious, I chose Pulumi</p></li>
<li><p>Backend API should store its state via AWS PaaS services. Either a real AWS account or an automated way to use Localstack, a tool that simulates AWS’s APIs in your local environment, would have worked</p></li>
<li><p>A Helm package to deploy the Kubernetes cluster</p></li>
<li><p>Health checking mechanisms</p></li>
<li><p>Scripts to tie everything together, making the cluster reproducible by following a series of steps outlined in a README file.</p></li>
<li><p>Horizontal autoscaling</p></li>
<li><p>Built-in application benchmarking</p></li>
</ul>
<p>The ultimate goal is now clear: creating a self-contained package that could easily reproduce a complete, production-ready REST API backend in a cloud native and scalable setup.</p>
<p><strong>Result</strong></p>
<p>Here’s the result of my work: <a class="reference external" href="https://github.com/alexpacio/python-webapp-boilerplate">https://github.com/alexpacio/python-webapp-boilerplate</a></p>
<p>Although there are a few rough edges and minor aspects that I handled in a superficial way, this serves as an example of how a modern, asynchronous FastAPI backend can be delivered within a single Git repository.
I believe it's a solid boilerplate to start with, and it allowed me to explore new tools like Pulumi, FastAPI, and other recent technologies.</p>
<p><strong>Thoughts</strong></p>
<p>Even though I feel like the entire AWS ecosystem is increasingly filling gaps (perhaps revenue gaps?) with bloat everywhere, I’ve been impressed with how concise, easy to use, develop, and reproduce a project like this can be. From this foundation, you can build a very sophisticated system while keeping everything in one place.
Additionally, you can test your AWS services locally and connect them later by simply using the Helm values file for the infrastructure or the .env file in the root folder for the application properties.</p>
<p>As mentioned, there’s definitely room for several small adjustments to make it work seamlessly, but I think this is a very solid and complete starting point! I may have missed something important, as I dedicated only a small portion of my time to this challenge.</p>
<p>Imagine having a temporary Kubernetes (K8s) namespace just to run your end-to-end (e2e) tests, reproducing the entire AWS PaaS stack and your application in a replicated and horizontally scalable way: you run the tests, collect the report, and then dispose of the environment.</p>
<p>The same approach can be used for your benchmarking needs.</p>
<p>With every change you make to your code, you can potentially test each step in your local cluster, which is automatically initialized in every aspect.</p>
<p>Just focus on your infrastructure and application code, set your environment variable files, and your portable cluster is up and running!</p>
<p><strong>Outcome</strong></p>
<p>I think I’ll continue to work on this. Cloud-native applications that avoid being locked into a specific cloud provider while still being distributed, scalable, and easy to use are possible.
I look forward to building an opinionated version of this soon. Stay tuned!</p>
<p><strong>Contribute!</strong></p>
<p>Feel free to use it as you wish, and let me know if you have any comments.</p>
<p>Cheers!</p>
    </div>
    </article><article class="post h-entry post-text"><header><h1 class="post-title p-name"><a href="posts/hello-world/" class="u-url">Hello world!</a></h1>
        <div class="metadata">
            <span class="post-date dateline"><time class="published dt-published" datetime="2024-09-21T16:41:03+02:00" title="2024-09-21 16:41">2024-09-21 16:41</time></span>
        </div>
    </header><div class="e-content entry-content">
    <p>This is my first post! I'm excited to start sharing tips on backend development, cloud computing, and more.</p>
    </div>
    </article>
</div>

    


    </div>
            <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
