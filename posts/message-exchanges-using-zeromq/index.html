<!DOCTYPE html>
<html prefix="" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Exchanging messages between processes (or even threads within the same program) using ZeroMQ | Alessandro's View</title>
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/dark.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Share+Tech+Mono" rel="stylesheet">
<link href="../../assets/css/custom.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#00ff00">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/">
<link rel="icon" href="../../files/favicon.svg" sizes="any">
<link rel="icon" href="../../files/favicon.ico" sizes="16x16">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Alessandro Bolletta">
<link rel="prev" href="../lightweight-nodejs-background-job-scheduler/" title="Building a Lightweight Node.js Background Job Scheduler: A Practical Solution for Simple Web Applications" type="text/html">
<link rel="next" href="../hidden-costs-static-linking-containerization/" title="The Hidden Costs of Static Linking and Containerization: A Critical Analysis" type="text/html">
<meta property="og:site_name" content="Alessandro's View">
<meta property="og:title" content="Exchanging messages between processes (or even threads within the same">
<meta property="og:url" content="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/">
<meta property="og:description" content='Inter-Process Communication with ZeroMQ (and Protocol Buffers)

Introduction
Some may certainly say that, when you are writing so called "daemons" under Linux/Unix OSes or "services" under Windows, yo'>
<meta property="og:type" content="article">
<meta property="article:published_time" content="2025-01-27T18:00:00Z">
<meta property="article:tag" content="C">
<meta property="article:tag" content="golang">
<meta property="article:tag" content="ZeroMQ">
</head>
<body class="hack dark">

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
         
    <header id="header"><h1 id="brand"><a href="../../" title="Alessandro's View" rel="home">
        <img src="../../files/logo.svg" alt="Alessandro's View" id="logo"></a></h1>
        <p id="blog-slogan">Sharing my views about computing. Debunking hype. Promoting what's worth.</p>

        

        
    <nav id="menu"><ul>
<li><a href="../../">Home</a></li>
                <li><a href="../../categories/">Topics</a></li>
                <li><a href="../../archive.html">Archive</a></li>
                <li><a href="../../pages/about/">About</a></li>
                <li><a href="../../files/cv.pdf">CV</a></li>
                <li><a href="https://github.com/alexpacio">GitHub</a></li>

    

    
    
    </ul></nav></header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Exchanging messages between processes (or even threads within the same program) using ZeroMQ</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Alessandro Bolletta
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2025-01-27T18:00:00Z" itemprop="datePublished" title="2025-01-27 18:00">2025-01-27 18:00</time></a>
            </p>
            
        <p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <section id="inter-process-communication-with-zeromq-and-protocol-buffers"><h2>Inter-Process Communication with ZeroMQ (and Protocol Buffers)</h2>
<section id="introduction"><h3>Introduction</h3>
<p>Some may certainly say that, when you are writing so called "daemons" under Linux/Unix OSes or "services" under Windows, you might want to use OS primitives/reuse existing libraries to make your programs communicate each other. And I strongly agree with the point: it is always a good idea to use a well-tested and solid library to implement such fundamental features such as message queues.</p>
<p>For example, under Linux you can use D-Bus, which allows IPC at scale within the OS scope. Or, in the microservices space, you can leverage on message brokers like RabbitMQ or Kafka to stream your messages through sophisticated routing logic. However, at times you are just looking for something trivial and simple to send and queue messages where at the same time you look for brokerless setup but still you are willing to leverage on some of the features that message queuing systems offer for free with ease. That's where ZeroMQ comes in.</p>
<!-- TEASER_END -->
</section><section id="what-is-zeromq"><h3>What is ZeroMQ?</h3>
<p>ZeroMQ (ØMQ) is a high-performance asynchronous messaging library aimed at use in distributed or concurrent applications. It provides a message queue, but unlike message-oriented middleware, a ZeroMQ system can run without a dedicated message broker. The API layer provides a message-oriented abstraction of asynchronous network communication, multiple messaging patterns, message filtering, and more.</p>
</section><section id="supported-transport-protocols"><h3>Supported Transport Protocols</h3>
<p>ZeroMQ supports various transport protocols through different URI schemes where the main ones are:</p>
<ul class="simple">
<li><p><code class="docutils literal"><span class="pre">tcp://</span></code> - TCP transport</p></li>
<li><p><code class="docutils literal"><span class="pre">ipc://</span></code> - Inter-process communication (Unix domain sockets)</p></li>
<li><p><code class="docutils literal"><span class="pre">inproc://</span></code> - In-process communication between threads</p></li>
</ul></section><section id="thread-safety-and-context-management"><h3>Thread Safety and Context Management</h3>
<p>In both C and Go, ZeroMQ contexts are thread-safe, but sockets are not. Here's how to handle them properly:</p>
<p>In Go:</p>
<div class="code"><pre class="code go"><a id="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-1" name="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-1" href="#rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-1"></a><span class="c1">// Thread-safe context creation</span>
<a id="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-2" name="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-2" href="#rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-2"></a><span class="nx">context</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewContext</span><span class="p">()</span>
<a id="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-3" name="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-3" href="#rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-3"></a>
<a id="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-4" name="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-4" href="#rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-4"></a><span class="c1">// Socket creation should be done in the thread that uses it</span>
<a id="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-5" name="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-5" href="#rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-5"></a><span class="nx">socket</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">PUSH</span><span class="p">)</span>
<a id="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-6" name="rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-6" href="#rest_code_c18d0f1155b24d4e8dcf3952fb87e6b7-6"></a><span class="k">defer</span><span class="w"> </span><span class="nx">socket</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
</pre></div>
<p>In C:</p>
<div class="code"><pre class="code c"><a id="rest_code_a7854987b99a4f1da47a941731518a7e-1" name="rest_code_a7854987b99a4f1da47a941731518a7e-1" href="#rest_code_a7854987b99a4f1da47a941731518a7e-1"></a><span class="c1">// Thread-safe context creation</span>
<a id="rest_code_a7854987b99a4f1da47a941731518a7e-2" name="rest_code_a7854987b99a4f1da47a941731518a7e-2" href="#rest_code_a7854987b99a4f1da47a941731518a7e-2"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_ctx_new</span><span class="p">();</span>
<a id="rest_code_a7854987b99a4f1da47a941731518a7e-3" name="rest_code_a7854987b99a4f1da47a941731518a7e-3" href="#rest_code_a7854987b99a4f1da47a941731518a7e-3"></a>
<a id="rest_code_a7854987b99a4f1da47a941731518a7e-4" name="rest_code_a7854987b99a4f1da47a941731518a7e-4" href="#rest_code_a7854987b99a4f1da47a941731518a7e-4"></a><span class="c1">// Socket creation - not thread-safe</span>
<a id="rest_code_a7854987b99a4f1da47a941731518a7e-5" name="rest_code_a7854987b99a4f1da47a941731518a7e-5" href="#rest_code_a7854987b99a4f1da47a941731518a7e-5"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">socket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_PUSH</span><span class="p">);</span>
</pre></div>
</section><section id="intra-thread-communication-example"><h3>Intra-Thread Communication Example</h3>
<p>Here's an example of thread communication using ZeroMQ in C:</p>
<div class="code"><pre class="code c"><a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-1" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-1" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;zmq.h&gt;</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-2" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-2" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;pthread.h&gt;</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-3" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-3" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-4" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-4" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-4"></a>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-5" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-5" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-5"></a><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">worker_routine</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-6" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-6" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-6"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">receiver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_PULL</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-7" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-7" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-7"></a><span class="w">    </span><span class="n">zmq_connect</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span><span class="w"> </span><span class="s">"inproc://workers"</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-8" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-8" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-8"></a>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-9" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-9" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-9"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-10" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-10" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-10"></a><span class="w">        </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-11" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-11" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-11"></a><span class="w">        </span><span class="n">zmq_recv</span><span class="p">(</span><span class="n">receiver</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-12" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-12" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-12"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">"Received: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-13" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-13" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-13"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-14" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-14" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-14"></a>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-15" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-15" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-15"></a><span class="w">    </span><span class="n">zmq_close</span><span class="p">(</span><span class="n">receiver</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-16" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-16" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-17" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-17" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-17"></a><span class="p">}</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-18" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-18" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-18"></a>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-19" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-19" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-19"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-20" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-20" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-20"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_ctx_new</span><span class="p">();</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-21" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-21" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-21"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">sender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_PUSH</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-22" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-22" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-22"></a>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-23" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-23" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-23"></a><span class="w">    </span><span class="n">zmq_bind</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="s">"inproc://workers"</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-24" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-24" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-24"></a>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-25" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-25" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-25"></a><span class="w">    </span><span class="n">pthread_t</span><span class="w"> </span><span class="n">worker</span><span class="p">;</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-26" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-26" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-26"></a><span class="w">    </span><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">worker</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">worker_routine</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-27" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-27" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-27"></a>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-28" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-28" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-28"></a><span class="w">    </span><span class="c1">// Send messages</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-29" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-29" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-29"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"Hello Worker!"</span><span class="p">;</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-30" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-30" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-30"></a><span class="w">    </span><span class="n">zmq_send</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">strlen</span><span class="p">(</span><span class="n">message</span><span class="p">),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-31" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-31" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-31"></a>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-32" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-32" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-32"></a><span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">  </span><span class="c1">// Allow time for message processing</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-33" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-33" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-33"></a>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-34" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-34" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-34"></a><span class="w">    </span><span class="n">zmq_close</span><span class="p">(</span><span class="n">sender</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-35" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-35" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-35"></a><span class="w">    </span><span class="n">zmq_ctx_destroy</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-36" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-36" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-36"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-37" name="rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-37" href="#rest_code_9cc3ec6954cf4061bdd9323d3ebe14d1-37"></a><span class="p">}</span>
</pre></div>
</section><section id="high-water-mark-and-flow-control"><h3>High Water Mark and Flow Control</h3>
<p>ZeroMQ provides flow control through the High Water Mark (HWM) feature. When the HWM is reached, ZeroMQ will either block or drop messages depending on the socket type and configuration:</p>
<div class="code"><pre class="code c"><a id="rest_code_ae2c516046894b3882c4be8a3bf2d6de-1" name="rest_code_ae2c516046894b3882c4be8a3bf2d6de-1" href="#rest_code_ae2c516046894b3882c4be8a3bf2d6de-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">hwm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
<a id="rest_code_ae2c516046894b3882c4be8a3bf2d6de-2" name="rest_code_ae2c516046894b3882c4be8a3bf2d6de-2" href="#rest_code_ae2c516046894b3882c4be8a3bf2d6de-2"></a><span class="n">zmq_setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_SNDHWM</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">hwm</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">hwm</span><span class="p">));</span>
<a id="rest_code_ae2c516046894b3882c4be8a3bf2d6de-3" name="rest_code_ae2c516046894b3882c4be8a3bf2d6de-3" href="#rest_code_ae2c516046894b3882c4be8a3bf2d6de-3"></a>
<a id="rest_code_ae2c516046894b3882c4be8a3bf2d6de-4" name="rest_code_ae2c516046894b3882c4be8a3bf2d6de-4" href="#rest_code_ae2c516046894b3882c4be8a3bf2d6de-4"></a><span class="c1">// To prevent dropping messages when HWM is reached</span>
<a id="rest_code_ae2c516046894b3882c4be8a3bf2d6de-5" name="rest_code_ae2c516046894b3882c4be8a3bf2d6de-5" href="#rest_code_ae2c516046894b3882c4be8a3bf2d6de-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">nodrop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="rest_code_ae2c516046894b3882c4be8a3bf2d6de-6" name="rest_code_ae2c516046894b3882c4be8a3bf2d6de-6" href="#rest_code_ae2c516046894b3882c4be8a3bf2d6de-6"></a><span class="n">zmq_setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_XPUB_NODROP</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">nodrop</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">nodrop</span><span class="p">));</span>
</pre></div>
</section><section id="protocol-buffers-integration"><h3>Protocol Buffers Integration</h3>
<p>Since ZeroMQ only transfers raw bytes, it pairs well with Protocol Buffers for structured data serialization. Here's an example using both C++ and Go:</p>
<p>First, define your protocol buffer:</p>
<div class="code"><pre class="code protobuf"><a id="rest_code_df25b530899d4397b83706506da47568-1" name="rest_code_df25b530899d4397b83706506da47568-1" href="#rest_code_df25b530899d4397b83706506da47568-1"></a><span class="c1">// message.proto</span>
<a id="rest_code_df25b530899d4397b83706506da47568-2" name="rest_code_df25b530899d4397b83706506da47568-2" href="#rest_code_df25b530899d4397b83706506da47568-2"></a><span class="k">syntax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"proto3"</span><span class="p">;</span>
<a id="rest_code_df25b530899d4397b83706506da47568-3" name="rest_code_df25b530899d4397b83706506da47568-3" href="#rest_code_df25b530899d4397b83706506da47568-3"></a>
<a id="rest_code_df25b530899d4397b83706506da47568-4" name="rest_code_df25b530899d4397b83706506da47568-4" href="#rest_code_df25b530899d4397b83706506da47568-4"></a><span class="kd">message</span><span class="w"> </span><span class="nc">DataMessage</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_df25b530899d4397b83706506da47568-5" name="rest_code_df25b530899d4397b83706506da47568-5" href="#rest_code_df25b530899d4397b83706506da47568-5"></a><span class="w">    </span><span class="kt">string</span><span class="w"> </span><span class="na">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="rest_code_df25b530899d4397b83706506da47568-6" name="rest_code_df25b530899d4397b83706506da47568-6" href="#rest_code_df25b530899d4397b83706506da47568-6"></a><span class="w">    </span><span class="kt">int64</span><span class="w"> </span><span class="na">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="rest_code_df25b530899d4397b83706506da47568-7" name="rest_code_df25b530899d4397b83706506da47568-7" href="#rest_code_df25b530899d4397b83706506da47568-7"></a><span class="p">}</span>
</pre></div>
<p>Using it in Go:</p>
<div class="code"><pre class="code go"><a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-1" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-1" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-2" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-2" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-2"></a>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-3" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-3" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-4" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-4" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-4"></a><span class="w">    </span><span class="s">"log"</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-5" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-5" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-5"></a>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-6" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-6" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-6"></a><span class="w">    </span><span class="s">"github.com/pebbe/zmq4"</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-7" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-7" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-7"></a><span class="w">    </span><span class="s">"google.golang.org/protobuf/proto"</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-8" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-8" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-8"></a><span class="w">    </span><span class="nx">examplepb</span><span class="w"> </span><span class="s">"path/to/generated/proto"</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-9" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-9" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-9"></a><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-10" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-10" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-10"></a>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-11" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-11" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-11"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-12" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-12" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-12"></a><span class="w">    </span><span class="c1">// Create a ZeroMQ context</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-13" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-13" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-13"></a><span class="w">    </span><span class="nx">context</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewContext</span><span class="p">()</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-14" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-14" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-15" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-15" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-15"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"Failed to create ZeroMQ context: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-16" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-16" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-16"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-17" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-17" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-17"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Term</span><span class="p">()</span><span class="w"> </span><span class="c1">// Ensure the context is terminated when the program exits</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-18" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-18" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-18"></a>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-19" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-19" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-19"></a><span class="w">    </span><span class="c1">// Create a ZeroMQ Subscriber socket</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-20" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-20" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-20"></a><span class="w">    </span><span class="nx">subscriber</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">SUB</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-21" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-21" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-22" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-22" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-22"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"Failed to create subscriber socket: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-23" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-23" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-23"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-24" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-24" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-24"></a><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-25" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-25" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-25"></a>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-26" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-26" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-26"></a><span class="w">    </span><span class="c1">// Connect to the publisher</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-27" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-27" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-27"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="s">"tcp://127.0.0.1:5555"</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-28" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-28" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-29" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-29" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-29"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"Failed to connect subscriber: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-30" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-30" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-30"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-31" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-31" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-31"></a>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-32" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-32" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-32"></a><span class="w">    </span><span class="c1">// Subscribe to all messages</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-33" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-33" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-33"></a><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">SetSubscribe</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-34" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-34" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-35" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-35" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-35"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatalf</span><span class="p">(</span><span class="s">"Failed to set subscription: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-36" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-36" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-36"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-37" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-37" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-37"></a>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-38" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-38" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-38"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">"Subscriber started, waiting for messages..."</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-39" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-39" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-39"></a>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-40" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-40" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-40"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-41" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-41" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-41"></a><span class="w">        </span><span class="c1">// Receive the serialized message</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-42" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-42" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-42"></a><span class="w">        </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">RecvBytes</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-43" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-43" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-43"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-44" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-44" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-44"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Failed to receive message: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-45" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-45" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-45"></a><span class="w">            </span><span class="k">continue</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-46" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-46" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-46"></a><span class="w">        </span><span class="p">}</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-47" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-47" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-47"></a>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-48" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-48" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-48"></a><span class="w">        </span><span class="c1">// Deserialize the message</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-49" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-49" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-49"></a><span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="nx">examplepb</span><span class="p">.</span><span class="nx">ExampleMessage</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-50" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-50" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-50"></a><span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">proto</span><span class="p">.</span><span class="nx">Unmarshal</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">message</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-51" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-51" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-51"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-52" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-52" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-52"></a><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Failed to deserialize message: %v"</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-53" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-53" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-53"></a><span class="w">            </span><span class="k">continue</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-54" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-54" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-54"></a><span class="w">        </span><span class="p">}</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-55" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-55" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-55"></a>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-56" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-56" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-56"></a><span class="w">        </span><span class="c1">// Print the received message</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-57" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-57" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-57"></a><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">"Received message: ID=%s, Content=%s"</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">.</span><span class="nx">Content</span><span class="p">)</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-58" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-58" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-58"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-59" name="rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-59" href="#rest_code_37c47c1e2a814b70a9f5a30fdf795cd7-59"></a><span class="p">}</span>
</pre></div>
</section><section id="explanation"><h3>Explanation</h3>
<p>Context: The zmq.NewContext() function creates a new ZeroMQ context, which is required to create sockets.</p>
<p>Socket: The context.NewSocket(zmq.SUB) function creates a new SUB socket for subscribing to messages.</p>
<p>Connect: The subscriber.Connect("<a class="reference external" href="tcp://localhost:5555">tcp://localhost:5555</a>") function connects the subscriber to the publisher’s address.</p>
<p>Subscribe: The socket.SetSubscribe("") function subscribes to all messages (an empty string means subscribe to everything). This acts as a way to subscribe to a string prefix (so called "topic" in other MQ systems)</p>
<p>Recv: The socket.RecvBytes(0) function blocks until a message is received.</p>
</section><section id="asynchronous-message-emission"><h3>Asynchronous Message Emission</h3>
<p>ZeroMQ supports non-blocking sends using the <code class="docutils literal">ZMQ_DONTWAIT</code> flag:</p>
<div class="code"><pre class="code c"><a id="rest_code_054636df4a2a42b0bf4153a7cb3d9d1f-1" name="rest_code_054636df4a2a42b0bf4153a7cb3d9d1f-1" href="#rest_code_054636df4a2a42b0bf4153a7cb3d9d1f-1"></a><span class="n">zmq_send</span><span class="p">(</span><span class="n">socket</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_DONTWAIT</span><span class="p">);</span>
<a id="rest_code_054636df4a2a42b0bf4153a7cb3d9d1f-2" name="rest_code_054636df4a2a42b0bf4153a7cb3d9d1f-2" href="#rest_code_054636df4a2a42b0bf4153a7cb3d9d1f-2"></a><span class="c1">// Code continues immediately without waiting for the send operation outcome</span>
</pre></div>
</section><section id="performance-considerations"><h3>Performance Considerations</h3>
<p>ZeroMQ is particularly well-suited for high-performance scenarios where:</p>
<ol class="arabic simple">
<li><p>You need to decouple the message producer from the consumer</p></li>
<li><p>The critical section needs to emit messages without blocking</p></li>
<li><p>You want to avoid the overhead of a message broker</p></li>
<li><p>You need reliable message delivery without managing it yourself</p></li>
</ol>
<p>The library handles many complex aspects automatically:</p>
<ul class="simple">
<li><p>Message framing</p></li>
<li><p>Connection handling and reconnection</p></li>
<li><p>Message queuing</p></li>
<li><p>Fair message distribution</p></li>
<li><p>Transport abstraction</p></li>
</ul></section><section id="zeromq-messaging-patterns"><h3>ZeroMQ Messaging Patterns</h3>
<p>ZeroMQ supports several fundamental messaging patterns, each designed for specific use cases:</p>
<section id="push-pull-pipeline"><h4>Push/Pull (Pipeline)</h4>
<p>The Push/Pull pattern creates a one-way data distribution pipeline. Messages sent by pushers are load-balanced among all connected pullers.</p>
<div class="code"><pre class="code c"><a id="rest_code_1aa6644d560040d484a54b397d3eaa92-1" name="rest_code_1aa6644d560040d484a54b397d3eaa92-1" href="#rest_code_1aa6644d560040d484a54b397d3eaa92-1"></a><span class="c1">// Pusher (sender)</span>
<a id="rest_code_1aa6644d560040d484a54b397d3eaa92-2" name="rest_code_1aa6644d560040d484a54b397d3eaa92-2" href="#rest_code_1aa6644d560040d484a54b397d3eaa92-2"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">pusher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_PUSH</span><span class="p">);</span>
<a id="rest_code_1aa6644d560040d484a54b397d3eaa92-3" name="rest_code_1aa6644d560040d484a54b397d3eaa92-3" href="#rest_code_1aa6644d560040d484a54b397d3eaa92-3"></a><span class="n">zmq_bind</span><span class="p">(</span><span class="n">pusher</span><span class="p">,</span><span class="w"> </span><span class="s">"tcp://*:5557"</span><span class="p">);</span>
<a id="rest_code_1aa6644d560040d484a54b397d3eaa92-4" name="rest_code_1aa6644d560040d484a54b397d3eaa92-4" href="#rest_code_1aa6644d560040d484a54b397d3eaa92-4"></a>
<a id="rest_code_1aa6644d560040d484a54b397d3eaa92-5" name="rest_code_1aa6644d560040d484a54b397d3eaa92-5" href="#rest_code_1aa6644d560040d484a54b397d3eaa92-5"></a><span class="c1">// Puller (receiver)</span>
<a id="rest_code_1aa6644d560040d484a54b397d3eaa92-6" name="rest_code_1aa6644d560040d484a54b397d3eaa92-6" href="#rest_code_1aa6644d560040d484a54b397d3eaa92-6"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">puller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_PULL</span><span class="p">);</span>
<a id="rest_code_1aa6644d560040d484a54b397d3eaa92-7" name="rest_code_1aa6644d560040d484a54b397d3eaa92-7" href="#rest_code_1aa6644d560040d484a54b397d3eaa92-7"></a><span class="n">zmq_connect</span><span class="p">(</span><span class="n">puller</span><span class="p">,</span><span class="w"> </span><span class="s">"tcp://localhost:5557"</span><span class="p">);</span>
</pre></div>
<p>Use cases:</p>
<ul class="simple">
<li><p>Parallel task distribution</p></li>
<li><p>Workload distribution in producer/consumer scenarios</p></li>
<li><p>Data pipeline processing</p></li>
</ul></section><section id="pub-sub-publisher-subscriber"><h4>Pub/Sub (Publisher/Subscriber)</h4>
<p>Publishers send messages while subscribers receive them based on topics. Each subscriber can subscribe to multiple topics.</p>
<div class="code"><pre class="code go"><a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-1" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-1" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-1"></a><span class="c1">// Publisher</span>
<a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-2" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-2" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-2"></a><span class="nx">publisher</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">PUB</span><span class="p">)</span>
<a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-3" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-3" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-3"></a><span class="nx">publisher</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="s">"tcp://*:5563"</span><span class="p">)</span>
<a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-4" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-4" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-4"></a>
<a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-5" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-5" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-5"></a><span class="c1">// Send message with topic</span>
<a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-6" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-6" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-6"></a><span class="nx">publisher</span><span class="p">.</span><span class="nx">Send</span><span class="p">(</span><span class="s">"weather.london temperature:22"</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-7" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-7" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-7"></a>
<a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-8" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-8" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-8"></a><span class="c1">// Subscriber</span>
<a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-9" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-9" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-9"></a><span class="nx">subscriber</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">SUB</span><span class="p">)</span>
<a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-10" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-10" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-10"></a><span class="nx">subscriber</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="s">"tcp://localhost:5563"</span><span class="p">)</span>
<a id="rest_code_0b0cf068b80646f79349cc1fdd6b476e-11" name="rest_code_0b0cf068b80646f79349cc1fdd6b476e-11" href="#rest_code_0b0cf068b80646f79349cc1fdd6b476e-11"></a><span class="nx">subscriber</span><span class="p">.</span><span class="nx">SetSubscribe</span><span class="p">(</span><span class="s">"weather.london"</span><span class="p">)</span>
</pre></div>
<p>Use cases:</p>
<ul class="simple">
<li><p>Event broadcasting</p></li>
<li><p>Real-time data feeds</p></li>
<li><p>System monitoring</p></li>
<li><p>Live updates</p></li>
</ul></section><section id="request-reply-req-rep"><h4>Request/Reply (REQ/REP)</h4>
<p>A synchronous pattern where each request must be followed by a reply.</p>
<div class="code"><pre class="code c"><a id="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-1" name="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-1" href="#rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-1"></a><span class="c1">// Server (Reply)</span>
<a id="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-2" name="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-2" href="#rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-2"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">responder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_REP</span><span class="p">);</span>
<a id="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-3" name="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-3" href="#rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-3"></a><span class="n">zmq_bind</span><span class="p">(</span><span class="n">responder</span><span class="p">,</span><span class="w"> </span><span class="s">"tcp://*:5555"</span><span class="p">);</span>
<a id="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-4" name="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-4" href="#rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-4"></a>
<a id="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-5" name="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-5" href="#rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-5"></a><span class="c1">// Client (Request)</span>
<a id="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-6" name="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-6" href="#rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-6"></a><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">requester</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zmq_socket</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">ZMQ_REQ</span><span class="p">);</span>
<a id="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-7" name="rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-7" href="#rest_code_6f86bb538a3f4ca2890b4c6cbc412cd4-7"></a><span class="n">zmq_connect</span><span class="p">(</span><span class="n">requester</span><span class="p">,</span><span class="w"> </span><span class="s">"tcp://localhost:5555"</span><span class="p">);</span>
</pre></div>
<p>Use cases:</p>
<ul class="simple">
<li><p>Remote procedure calls (RPC)</p></li>
<li><p>Service APIs</p></li>
<li><p>Task delegation with acknowledgment</p></li>
</ul></section><section id="dealer-router"><h4>Dealer/Router</h4>
<p>An advanced asynchronous pattern that allows for complex routing scenarios.</p>
<div class="code"><pre class="code go"><a id="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-1" name="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-1" href="#rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-1"></a><span class="c1">// Router</span>
<a id="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-2" name="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-2" href="#rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-2"></a><span class="nx">router</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">ROUTER</span><span class="p">)</span>
<a id="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-3" name="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-3" href="#rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-3"></a><span class="nx">router</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="s">"tcp://*:5555"</span><span class="p">)</span>
<a id="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-4" name="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-4" href="#rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-4"></a>
<a id="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-5" name="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-5" href="#rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-5"></a><span class="c1">// Dealer</span>
<a id="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-6" name="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-6" href="#rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-6"></a><span class="nx">dealer</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">DEALER</span><span class="p">)</span>
<a id="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-7" name="rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-7" href="#rest_code_5e92cfca5e4f40f6a23dd2266502d7ff-7"></a><span class="nx">dealer</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="s">"tcp://localhost:5555"</span><span class="p">)</span>
</pre></div>
<p>Use cases:</p>
<ul class="simple">
<li><p>Load balancing</p></li>
<li><p>Asynchronous request/reply</p></li>
<li><p>Complex routing topologies</p></li>
<li><p>Service meshes</p></li>
</ul></section><section id="pattern-selection-guidelines"><h4>Pattern Selection Guidelines</h4>
<p>When choosing a pattern, consider:</p>
<p>Message Flow Direction:</p>
<ul class="simple">
<li><p>One-way: Push/Pull or Pub/Sub</p></li>
<li><p>Two-way: Request/Reply or Dealer/Router</p></li>
</ul>
<p>Synchronization Requirements:</p>
<ul class="simple">
<li><p>Synchronous: Request/Reply</p></li>
<li><p>Asynchronous: Push/Pull, Pub/Sub, Dealer/Router</p></li>
</ul>
<p>Scalability Needs:</p>
<ul class="simple">
<li><p>Fan-out: Pub/Sub</p></li>
<li><p>Load balancing: Push/Pull or Dealer/Router</p></li>
<li><p>Both: Combination of patterns</p></li>
</ul>
<p>Message Delivery Guarantees:</p>
<ul class="simple">
<li><p>At-most-once: Pub/Sub</p></li>
<li><p>At-least-once: Request/Reply</p></li>
<li><p>Custom guarantees: Dealer/Router</p></li>
</ul></section><section id="example-combining-patterns"><h4>Example: Combining Patterns</h4>
<p>Here's an example combining Pub/Sub with Push/Pull for a logging system:</p>
<div class="code"><pre class="code go"><a id="rest_code_e456fa79168844dc9fb058e9405d1f37-1" name="rest_code_e456fa79168844dc9fb058e9405d1f37-1" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-2" name="rest_code_e456fa79168844dc9fb058e9405d1f37-2" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-2"></a>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-3" name="rest_code_e456fa79168844dc9fb058e9405d1f37-3" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-4" name="rest_code_e456fa79168844dc9fb058e9405d1f37-4" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-4"></a><span class="w">    </span><span class="s">"github.com/pebbe/zmq4"</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-5" name="rest_code_e456fa79168844dc9fb058e9405d1f37-5" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-5"></a><span class="w">    </span><span class="s">"log"</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-6" name="rest_code_e456fa79168844dc9fb058e9405d1f37-6" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-6"></a><span class="p">)</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-7" name="rest_code_e456fa79168844dc9fb058e9405d1f37-7" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-7"></a>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-8" name="rest_code_e456fa79168844dc9fb058e9405d1f37-8" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-9" name="rest_code_e456fa79168844dc9fb058e9405d1f37-9" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-9"></a><span class="w">    </span><span class="c1">// Event publisher</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-10" name="rest_code_e456fa79168844dc9fb058e9405d1f37-10" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-10"></a><span class="w">    </span><span class="nx">publisher</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">PUB</span><span class="p">)</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-11" name="rest_code_e456fa79168844dc9fb058e9405d1f37-11" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-11"></a><span class="w">    </span><span class="nx">publisher</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="s">"tcp://*:5563"</span><span class="p">)</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-12" name="rest_code_e456fa79168844dc9fb058e9405d1f37-12" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-12"></a>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-13" name="rest_code_e456fa79168844dc9fb058e9405d1f37-13" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-13"></a><span class="w">    </span><span class="c1">// Log collector</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-14" name="rest_code_e456fa79168844dc9fb058e9405d1f37-14" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-14"></a><span class="w">    </span><span class="nx">collector</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">PULL</span><span class="p">)</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-15" name="rest_code_e456fa79168844dc9fb058e9405d1f37-15" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-15"></a><span class="w">    </span><span class="nx">collector</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="s">"tcp://*:5564"</span><span class="p">)</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-16" name="rest_code_e456fa79168844dc9fb058e9405d1f37-16" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-16"></a>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-17" name="rest_code_e456fa79168844dc9fb058e9405d1f37-17" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-17"></a><span class="w">    </span><span class="c1">// Worker that processes logs and publishes events</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-18" name="rest_code_e456fa79168844dc9fb058e9405d1f37-18" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-18"></a><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-19" name="rest_code_e456fa79168844dc9fb058e9405d1f37-19" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-19"></a><span class="w">        </span><span class="nx">worker</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">PUSH</span><span class="p">)</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-20" name="rest_code_e456fa79168844dc9fb058e9405d1f37-20" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-20"></a><span class="w">        </span><span class="nx">worker</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="s">"tcp://localhost:5564"</span><span class="p">)</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-21" name="rest_code_e456fa79168844dc9fb058e9405d1f37-21" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-21"></a>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-22" name="rest_code_e456fa79168844dc9fb058e9405d1f37-22" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-22"></a><span class="w">        </span><span class="nx">subscriber</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">NewSocket</span><span class="p">(</span><span class="nx">zmq4</span><span class="p">.</span><span class="nx">SUB</span><span class="p">)</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-23" name="rest_code_e456fa79168844dc9fb058e9405d1f37-23" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-23"></a><span class="w">        </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">Connect</span><span class="p">(</span><span class="s">"tcp://localhost:5563"</span><span class="p">)</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-24" name="rest_code_e456fa79168844dc9fb058e9405d1f37-24" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-24"></a><span class="w">        </span><span class="nx">subscriber</span><span class="p">.</span><span class="nx">SetSubscribe</span><span class="p">(</span><span class="s">"error"</span><span class="p">)</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-25" name="rest_code_e456fa79168844dc9fb058e9405d1f37-25" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-25"></a>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-26" name="rest_code_e456fa79168844dc9fb058e9405d1f37-26" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-26"></a><span class="w">        </span><span class="c1">// Process messages...</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-27" name="rest_code_e456fa79168844dc9fb058e9405d1f37-27" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-27"></a><span class="w">    </span><span class="p">}()</span>
<a id="rest_code_e456fa79168844dc9fb058e9405d1f37-28" name="rest_code_e456fa79168844dc9fb058e9405d1f37-28" href="#rest_code_e456fa79168844dc9fb058e9405d1f37-28"></a><span class="p">}</span>
</pre></div>
<p>This setup allows for:
- Real-time error broadcasting (Pub/Sub)
- Reliable log collection (Push/Pull)
- Scalable processing workers
- Decoupled components</p>
<p>The choice of pattern significantly impacts your system's behavior, performance, and scalability. It's often beneficial to combine patterns to achieve more complex messaging requirements while maintaining simplicity in individual components.</p>
</section></section><section id="conclusion"><h3>Conclusion</h3>
<p>When you need a lightweight, broker-less messaging solution with good performance characteristics, ZeroMQ provides an excellent balance of features and simplicity. It's particularly valuable in scenarios where you need to quickly implement reliable inter-process or inter-thread communication without the overhead of a full message broker infrastructure.</p>
<p>While it may not replace more robust solutions like Kafka for large-scale distributed systems, ZeroMQ fills an important niche for local and small-scale distributed messaging needs, especially when performance is a critical factor.</p>
</section><section id="useful-links"><h3>Useful Links</h3>
<ul class="simple">
<li><p>ZeroMQ Official Website: <a class="reference external" href="https://zeromq.org/">https://zeromq.org/</a></p></li>
<li><p>ZeroMQ Documentation: <a class="reference external" href="https://zeromq.org/get-started/">https://zeromq.org/get-started/</a></p></li>
<li><p>Protocol Buffers Official Website: <a class="reference external" href="https://protobuf.dev/">https://protobuf.dev/</a></p></li>
<li><p>Protocol Buffers Documentation: <a class="reference external" href="https://protobuf.dev/overview/">https://protobuf.dev/overview/</a></p></li>
<li><p>ZeroMQ Guide: <a class="reference external" href="https://zguide.zeromq.org/">https://zguide.zeromq.org/</a></p></li>
</ul></section></section>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/c/" rel="tag">C</a></li>
            <li><a class="tag p-category" href="../../categories/golang/" rel="tag">golang</a></li>
            <li><a class="tag p-category" href="../../categories/zeromq/" rel="tag">ZeroMQ</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../lightweight-nodejs-background-job-scheduler/" rel="prev" title="Building a Lightweight Node.js Background Job Scheduler: A Practical Solution for Simple Web Applications">Previous post</a>
            </li>
            <li class="next">
                <a href="../hidden-costs-static-linking-containerization/" rel="next" title="The Hidden Costs of Static Linking and Containerization: A Critical Analysis">Next post</a>
            </li>
        </ul></nav></aside></article></main><footer id="footer"><p>Contents © 2025         <a href="mailto:alexpacio91%20at%20gmail%20dot%20com">Alessandro Bolletta</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>
</div>
    
    

    
    
    
</body>
</html>
