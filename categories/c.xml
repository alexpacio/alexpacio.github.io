<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Alessandro Bolletta (Posts about C)</title><link>https://alexpacio.github.io/</link><description></description><atom:link href="https://alexpacio.github.io/categories/c.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2025 &lt;a href="mailto:alexpacio91 at gmail dot com"&gt;Alessandro Bolletta&lt;/a&gt; </copyright><lastBuildDate>Mon, 27 Jan 2025 19:44:52 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Exchanging messages between processes (or even threads within the same program) using ZeroMQ</title><link>https://alexpacio.github.io/posts/message-exchanges-using-zeromq/</link><dc:creator>Alessandro Bolletta</dc:creator><description>&lt;section id="inter-process-communication-with-zeromq-and-protocol-buffers"&gt;
&lt;h2&gt;Inter-Process Communication with ZeroMQ (and Protocol Buffers)&lt;/h2&gt;
&lt;section id="introduction"&gt;
&lt;h3&gt;Introduction&lt;/h3&gt;
&lt;p&gt;Some may certainly say that, when you are writing so called "daemons" under Linux/Unix OSes or "services" under Windows, you might want to use OS primitives/reuse existing libraries to make your programs communicate each other. And I strongly agree with the point: it is always a good idea to use a well-tested and solid library to implement such fundamental features such as message queues.&lt;/p&gt;
&lt;p&gt;For example, under Linux you can use D-Bus, which allows IPC at scale within the OS scope. Or, in the microservices space, you can leverage on message brokers like RabbitMQ or Kafka to stream your messages through sophisticated routing logic. However, at times you are just looking for something trivial and simple to send and queue messages where at the same time you look for brokerless setup but still you are willing to leverage on some of the features that they offer for free and with ease. That's where ZeroMQ comes in.&lt;/p&gt;
&lt;/section&gt;
&lt;section id="what-is-zeromq"&gt;
&lt;h3&gt;What is ZeroMQ?&lt;/h3&gt;
&lt;p&gt;ZeroMQ (ØMQ) is a high-performance asynchronous messaging library aimed at use in distributed or concurrent applications. It provides a message queue, but unlike message-oriented middleware, a ZeroMQ system can run without a dedicated message broker. The API layer provides a message-oriented abstraction of asynchronous network communication, multiple messaging patterns, message filtering, and more.&lt;/p&gt;
&lt;/section&gt;
&lt;section id="supported-transport-protocols"&gt;
&lt;h3&gt;Supported Transport Protocols&lt;/h3&gt;
&lt;p&gt;ZeroMQ supports various transport protocols through different URI schemes where the main ones are:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;p&gt;&lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;tcp://&lt;/span&gt;&lt;/code&gt; - TCP transport&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;ipc://&lt;/span&gt;&lt;/code&gt; - Inter-process communication (Unix domain sockets)&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;code class="docutils literal"&gt;&lt;span class="pre"&gt;inproc://&lt;/span&gt;&lt;/code&gt; - In-process communication between threads&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/section&gt;
&lt;section id="thread-safety-and-context-management"&gt;
&lt;h3&gt;Thread Safety and Context Management&lt;/h3&gt;
&lt;p&gt;In both C and Go, ZeroMQ contexts are thread-safe, but sockets are not. Here's how to handle them properly:&lt;/p&gt;
&lt;p&gt;In Go:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code go"&gt;&lt;a id="rest_code_e1ab2a64141546aaba124794934ed69a-1" name="rest_code_e1ab2a64141546aaba124794934ed69a-1" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_e1ab2a64141546aaba124794934ed69a-1"&gt;&lt;/a&gt;&lt;span class="c1"&gt;// Thread-safe context creation&lt;/span&gt;
&lt;a id="rest_code_e1ab2a64141546aaba124794934ed69a-2" name="rest_code_e1ab2a64141546aaba124794934ed69a-2" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_e1ab2a64141546aaba124794934ed69a-2"&gt;&lt;/a&gt;&lt;span class="nx"&gt;context&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;zmq4&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;NewContext&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a id="rest_code_e1ab2a64141546aaba124794934ed69a-3" name="rest_code_e1ab2a64141546aaba124794934ed69a-3" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_e1ab2a64141546aaba124794934ed69a-3"&gt;&lt;/a&gt;
&lt;a id="rest_code_e1ab2a64141546aaba124794934ed69a-4" name="rest_code_e1ab2a64141546aaba124794934ed69a-4" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_e1ab2a64141546aaba124794934ed69a-4"&gt;&lt;/a&gt;&lt;span class="c1"&gt;// Socket creation should be done in the thread that uses it&lt;/span&gt;
&lt;a id="rest_code_e1ab2a64141546aaba124794934ed69a-5" name="rest_code_e1ab2a64141546aaba124794934ed69a-5" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_e1ab2a64141546aaba124794934ed69a-5"&gt;&lt;/a&gt;&lt;span class="nx"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;context&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;NewSocket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;zmq4&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;PUSH&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_e1ab2a64141546aaba124794934ed69a-6" name="rest_code_e1ab2a64141546aaba124794934ed69a-6" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_e1ab2a64141546aaba124794934ed69a-6"&gt;&lt;/a&gt;&lt;span class="k"&gt;defer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In C:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code c"&gt;&lt;a id="rest_code_5dba980e0754469ca6d4c35265edb050-1" name="rest_code_5dba980e0754469ca6d4c35265edb050-1" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_5dba980e0754469ca6d4c35265edb050-1"&gt;&lt;/a&gt;&lt;span class="c1"&gt;// Thread-safe context creation&lt;/span&gt;
&lt;a id="rest_code_5dba980e0754469ca6d4c35265edb050-2" name="rest_code_5dba980e0754469ca6d4c35265edb050-2" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_5dba980e0754469ca6d4c35265edb050-2"&gt;&lt;/a&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;zmq_ctx_new&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;a id="rest_code_5dba980e0754469ca6d4c35265edb050-3" name="rest_code_5dba980e0754469ca6d4c35265edb050-3" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_5dba980e0754469ca6d4c35265edb050-3"&gt;&lt;/a&gt;
&lt;a id="rest_code_5dba980e0754469ca6d4c35265edb050-4" name="rest_code_5dba980e0754469ca6d4c35265edb050-4" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_5dba980e0754469ca6d4c35265edb050-4"&gt;&lt;/a&gt;&lt;span class="c1"&gt;// Socket creation - not thread-safe&lt;/span&gt;
&lt;a id="rest_code_5dba980e0754469ca6d4c35265edb050-5" name="rest_code_5dba980e0754469ca6d4c35265edb050-5" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_5dba980e0754469ca6d4c35265edb050-5"&gt;&lt;/a&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;zmq_socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ZMQ_PUSH&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/section&gt;
&lt;section id="intra-thread-communication-example"&gt;
&lt;h3&gt;Intra-Thread Communication Example&lt;/h3&gt;
&lt;p&gt;Here's an example of thread communication using ZeroMQ in C:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code c"&gt;&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-1" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-1" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-1"&gt;&lt;/a&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;zmq.h&amp;gt;&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-2" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-2" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-2"&gt;&lt;/a&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;pthread.h&amp;gt;&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-3" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-3" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-3"&gt;&lt;/a&gt;&lt;span class="cp"&gt;#include&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="cpf"&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-4" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-4" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-4"&gt;&lt;/a&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-5" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-5" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-5"&gt;&lt;/a&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;worker_routine&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-6" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-6" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-6"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;receiver&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;zmq_socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ZMQ_PULL&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-7" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-7" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-7"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;zmq_connect&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;receiver&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;"inproc://workers"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-8" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-8" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-8"&gt;&lt;/a&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-9" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-9" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-9"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;while&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-10" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-10" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-10"&gt;&lt;/a&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;256&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-11" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-11" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-11"&gt;&lt;/a&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;zmq_recv&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;receiver&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-12" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-12" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-12"&gt;&lt;/a&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="n"&gt;printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Received: %s&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-13" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-13" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-13"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-14" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-14" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-14"&gt;&lt;/a&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-15" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-15" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-15"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;zmq_close&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;receiver&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-16" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-16" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-16"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-17" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-17" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-17"&gt;&lt;/a&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-18" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-18" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-18"&gt;&lt;/a&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-19" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-19" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-19"&gt;&lt;/a&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-20" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-20" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-20"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;zmq_ctx_new&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-21" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-21" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-21"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;void&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;sender&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;zmq_socket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ZMQ_PUSH&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-22" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-22" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-22"&gt;&lt;/a&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-23" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-23" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-23"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;zmq_bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sender&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;"inproc://workers"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-24" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-24" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-24"&gt;&lt;/a&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-25" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-25" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-25"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;pthread_t&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-26" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-26" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-26"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;pthread_create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;worker&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;worker_routine&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-27" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-27" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-27"&gt;&lt;/a&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-28" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-28" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-28"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;// Send messages&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-29" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-29" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-29"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;const&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="kt"&gt;char&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;"Hello Worker!"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-30" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-30" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-30"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;zmq_send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sender&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;strlen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-31" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-31" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-31"&gt;&lt;/a&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-32" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-32" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-32"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;sleep&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="c1"&gt;// Allow time for message processing&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-33" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-33" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-33"&gt;&lt;/a&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-34" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-34" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-34"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;zmq_close&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sender&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-35" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-35" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-35"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="n"&gt;zmq_ctx_destroy&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;context&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-36" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-36" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-36"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a id="rest_code_161e7ac2c18c419aa8cb0790b36511e6-37" name="rest_code_161e7ac2c18c419aa8cb0790b36511e6-37" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_161e7ac2c18c419aa8cb0790b36511e6-37"&gt;&lt;/a&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/section&gt;
&lt;section id="high-water-mark-and-flow-control"&gt;
&lt;h3&gt;High Water Mark and Flow Control&lt;/h3&gt;
&lt;p&gt;ZeroMQ provides flow control through the High Water Mark (HWM) feature. When the HWM is reached, ZeroMQ will either block or drop messages depending on the socket type and configuration:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code c"&gt;&lt;a id="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-1" name="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-1" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_65641e36b0704015bdb4f6b3be5bf5a7-1"&gt;&lt;/a&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;hwm&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a id="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-2" name="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-2" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_65641e36b0704015bdb4f6b3be5bf5a7-2"&gt;&lt;/a&gt;&lt;span class="n"&gt;zmq_setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ZMQ_SNDHWM&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;hwm&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;hwm&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;a id="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-3" name="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-3" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_65641e36b0704015bdb4f6b3be5bf5a7-3"&gt;&lt;/a&gt;
&lt;a id="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-4" name="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-4" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_65641e36b0704015bdb4f6b3be5bf5a7-4"&gt;&lt;/a&gt;&lt;span class="c1"&gt;// To prevent dropping messages when HWM is reached&lt;/span&gt;
&lt;a id="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-5" name="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-5" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_65641e36b0704015bdb4f6b3be5bf5a7-5"&gt;&lt;/a&gt;&lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;nodrop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a id="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-6" name="rest_code_65641e36b0704015bdb4f6b3be5bf5a7-6" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_65641e36b0704015bdb4f6b3be5bf5a7-6"&gt;&lt;/a&gt;&lt;span class="n"&gt;zmq_setsockopt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ZMQ_XPUB_NODROP&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;nodrop&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="k"&gt;sizeof&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nodrop&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/section&gt;
&lt;section id="protocol-buffers-integration"&gt;
&lt;h3&gt;Protocol Buffers Integration&lt;/h3&gt;
&lt;p&gt;Since ZeroMQ only transfers raw bytes, it pairs well with Protocol Buffers for structured data serialization. Here's an example using both C++ and Go:&lt;/p&gt;
&lt;p&gt;First, define your protocol buffer:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code protobuf"&gt;&lt;a id="rest_code_889c32d7573a41fcb9ee605483e7827e-1" name="rest_code_889c32d7573a41fcb9ee605483e7827e-1" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_889c32d7573a41fcb9ee605483e7827e-1"&gt;&lt;/a&gt;&lt;span class="c1"&gt;// message.proto&lt;/span&gt;
&lt;a id="rest_code_889c32d7573a41fcb9ee605483e7827e-2" name="rest_code_889c32d7573a41fcb9ee605483e7827e-2" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_889c32d7573a41fcb9ee605483e7827e-2"&gt;&lt;/a&gt;&lt;span class="k"&gt;syntax&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;"proto3"&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a id="rest_code_889c32d7573a41fcb9ee605483e7827e-3" name="rest_code_889c32d7573a41fcb9ee605483e7827e-3" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_889c32d7573a41fcb9ee605483e7827e-3"&gt;&lt;/a&gt;
&lt;a id="rest_code_889c32d7573a41fcb9ee605483e7827e-4" name="rest_code_889c32d7573a41fcb9ee605483e7827e-4" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_889c32d7573a41fcb9ee605483e7827e-4"&gt;&lt;/a&gt;&lt;span class="kd"&gt;message&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nc"&gt;DataMessage&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;a id="rest_code_889c32d7573a41fcb9ee605483e7827e-5" name="rest_code_889c32d7573a41fcb9ee605483e7827e-5" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_889c32d7573a41fcb9ee605483e7827e-5"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;string&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="na"&gt;content&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a id="rest_code_889c32d7573a41fcb9ee605483e7827e-6" name="rest_code_889c32d7573a41fcb9ee605483e7827e-6" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_889c32d7573a41fcb9ee605483e7827e-6"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="kt"&gt;int64&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="na"&gt;timestamp&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;a id="rest_code_889c32d7573a41fcb9ee605483e7827e-7" name="rest_code_889c32d7573a41fcb9ee605483e7827e-7" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_889c32d7573a41fcb9ee605483e7827e-7"&gt;&lt;/a&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using it in Go:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code go"&gt;&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-1" name="rest_code_1c6de8b5d43149848033065349555fad-1" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-1"&gt;&lt;/a&gt;&lt;span class="kn"&gt;package&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;main&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-2" name="rest_code_1c6de8b5d43149848033065349555fad-2" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-2"&gt;&lt;/a&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-3" name="rest_code_1c6de8b5d43149848033065349555fad-3" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-3"&gt;&lt;/a&gt;&lt;span class="kn"&gt;import&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-4" name="rest_code_1c6de8b5d43149848033065349555fad-4" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-4"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;"log"&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-5" name="rest_code_1c6de8b5d43149848033065349555fad-5" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-5"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nx"&gt;pb&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s"&gt;"path/to/generated/proto"&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-6" name="rest_code_1c6de8b5d43149848033065349555fad-6" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-6"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;"github.com/pebbe/zmq4"&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-7" name="rest_code_1c6de8b5d43149848033065349555fad-7" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-7"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="s"&gt;"google.golang.org/protobuf/proto"&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-8" name="rest_code_1c6de8b5d43149848033065349555fad-8" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-8"&gt;&lt;/a&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-9" name="rest_code_1c6de8b5d43149848033065349555fad-9" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-9"&gt;&lt;/a&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-10" name="rest_code_1c6de8b5d43149848033065349555fad-10" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-10"&gt;&lt;/a&gt;&lt;span class="kd"&gt;func&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;main&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-11" name="rest_code_1c6de8b5d43149848033065349555fad-11" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-11"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nx"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;zmq4&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;NewSocket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;zmq4&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;PULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-12" name="rest_code_1c6de8b5d43149848033065349555fad-12" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-12"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;defer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Close&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-13" name="rest_code_1c6de8b5d43149848033065349555fad-13" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-13"&gt;&lt;/a&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-14" name="rest_code_1c6de8b5d43149848033065349555fad-14" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-14"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nx"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"tcp://*:5555"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-15" name="rest_code_1c6de8b5d43149848033065349555fad-15" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-15"&gt;&lt;/a&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-16" name="rest_code_1c6de8b5d43149848033065349555fad-16" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-16"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="k"&gt;for&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-17" name="rest_code_1c6de8b5d43149848033065349555fad-17" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-17"&gt;&lt;/a&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;RecvBytes&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-18" name="rest_code_1c6de8b5d43149848033065349555fad-18" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-18"&gt;&lt;/a&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;msg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;:=&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="nx"&gt;pb&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;DataMessage&lt;/span&gt;&lt;span class="p"&gt;{}&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-19" name="rest_code_1c6de8b5d43149848033065349555fad-19" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-19"&gt;&lt;/a&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;proto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Unmarshal&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-20" name="rest_code_1c6de8b5d43149848033065349555fad-20" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-20"&gt;&lt;/a&gt;&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Printf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Received: %s at %d"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Content&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nx"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Timestamp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-21" name="rest_code_1c6de8b5d43149848033065349555fad-21" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-21"&gt;&lt;/a&gt;&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;a id="rest_code_1c6de8b5d43149848033065349555fad-22" name="rest_code_1c6de8b5d43149848033065349555fad-22" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_1c6de8b5d43149848033065349555fad-22"&gt;&lt;/a&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/section&gt;
&lt;section id="asynchronous-message-emission"&gt;
&lt;h3&gt;Asynchronous Message Emission&lt;/h3&gt;
&lt;p&gt;ZeroMQ supports non-blocking sends using the &lt;code class="docutils literal"&gt;ZMQ_DONTWAIT&lt;/code&gt; flag:&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code c"&gt;&lt;a id="rest_code_75942c5f8ed94bc2b5bb330fcea667fc-1" name="rest_code_75942c5f8ed94bc2b5bb330fcea667fc-1" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_75942c5f8ed94bc2b5bb330fcea667fc-1"&gt;&lt;/a&gt;&lt;span class="n"&gt;zmq_send&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;socket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;message&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="n"&gt;ZMQ_DONTWAIT&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;a id="rest_code_75942c5f8ed94bc2b5bb330fcea667fc-2" name="rest_code_75942c5f8ed94bc2b5bb330fcea667fc-2" href="https://alexpacio.github.io/posts/message-exchanges-using-zeromq/#rest_code_75942c5f8ed94bc2b5bb330fcea667fc-2"&gt;&lt;/a&gt;&lt;span class="c1"&gt;// Code continues immediately without waiting&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/section&gt;
&lt;section id="performance-considerations"&gt;
&lt;h3&gt;Performance Considerations&lt;/h3&gt;
&lt;p&gt;ZeroMQ is particularly well-suited for high-performance scenarios where:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;&lt;p&gt;You need to decouple the message producer from the consumer&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;The critical section needs to emit messages without blocking&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;You want to avoid the overhead of a message broker&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;You need reliable message delivery without managing it yourself&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The library handles many complex aspects automatically:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;p&gt;Message framing&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Connection handling and reconnection&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Message queuing&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Fair message distribution&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Transport abstraction&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/section&gt;
&lt;section id="conclusion"&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;When you need a lightweight, broker-less messaging solution with good performance characteristics, ZeroMQ provides an excellent balance of features and simplicity. It's particularly valuable in scenarios where you need to quickly implement reliable inter-process or inter-thread communication without the overhead of a full message broker infrastructure.&lt;/p&gt;
&lt;p&gt;While it may not replace more robust solutions like Kafka for large-scale distributed systems, ZeroMQ fills an important niche for local and small-scale distributed messaging needs, especially when performance is a critical factor.&lt;/p&gt;
&lt;/section&gt;
&lt;section id="useful-links"&gt;
&lt;h3&gt;Useful Links&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;p&gt;ZeroMQ Official Website: &lt;a class="reference external" href="https://zeromq.org/"&gt;https://zeromq.org/&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ZeroMQ Documentation: &lt;a class="reference external" href="https://zeromq.org/get-started/"&gt;https://zeromq.org/get-started/&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Protocol Buffers Official Website: &lt;a class="reference external" href="https://protobuf.dev/"&gt;https://protobuf.dev/&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;Protocol Buffers Documentation: &lt;a class="reference external" href="https://protobuf.dev/overview/"&gt;https://protobuf.dev/overview/&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;ZeroMQ Guide: &lt;a class="reference external" href="https://zguide.zeromq.org/"&gt;https://zguide.zeromq.org/&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/section&gt;
&lt;/section&gt;</description><category>C</category><category>golang</category><category>ZeroMQ</category><guid>https://alexpacio.github.io/posts/message-exchanges-using-zeromq/</guid><pubDate>Mon, 27 Jan 2025 18:00:00 GMT</pubDate></item></channel></rss>